<!DOCTYPE html>
<html>
<head>
<!-- Article ID: 42 - Extracted from develop-1993 -->
<!-- on 2024-02-03 by Giorgio Ferrara - giorgio<dot>ferrara<at>gmail<dot>com -->
<!-- The content is protected by the copyright of its respective owners -->
<title>December 93 - SOMEWHERE IN QUICKTIME</title>
<link href="../common/styles/main.css" rel="stylesheet" type="text/css">
</head>
<body>
<h2>SOMEWHERE IN QUICKTIME</h2>
<h2>WHAT'S NEW WITH SOUND MANAGER 3.0</h2>
<h1>JIM REEKES</h1>
<p>
<img src="img/239.gif" width="180 px"></img>
</p>
<p>
Sound Manager 3.0, a vastly improved call-for-call replacement for the Sound<br>
Manager in System 7, provides QuickTime and other sound clients with a set of new and<br>
improved features, including higher frame rates and better quality sound. Sound<br>
Manager 3.0 is an extension that entirely replaces the older Sound Manager; the<br>
extension is included along with a new Sound control panel on this issue's CD. We<br>
released it as an extension without changing the API so that you won't have to recode<br>
your existing applications. With Sound Manager 3.0 installed in your system, your<br>
applications will transparently take advantage of the Sound Manager's greater<br>
dependability, speed, and other new features. 
</p>
<p>
The soon-to-be-available Inside Macintosh: Sound(or Inside Macintosh Volume VI,<br>
Chapter 22) is the main source of Sound Manager documentation. This column will<br>
discuss some of the new features of Sound Manager 3.0 and describe how to use them. 
</p>
<p>
<b>OVERVIEW OF MAJOR NEW FEATURES</b><br>
Sound Manager 3.0 provides four major new features:
</p>
<ul>
<li>support for 16-bit audio samples</li>
<li>support for third-party audio hardware</li>
<li>support for plug-in audio codecs</li>
<li>better performance and quality</li>
</ul>
<p>
Previous versions of the Sound Manager could only support stereo 8-bit audio samples<br>
with sample rates up to 22 kHz. Sound Manager 3.0 removes this limitation by<br>
allowing stereo 16-bit audio samples with sample rates up to 65 kHz, providing<br>
CD-quality audio in QuickTime movies and other audio applications. Sound Manager 3.0<br>
will also automatically convert 16-bit sounds into 8-bit sounds on Macintosh<br>
computers that don't have 16-bit audio hardware. 
</p>
<p>
Third-party sound cards can be installed in your Macintosh to allow playback and<br>
recording of CD- quality audio. Sound Manager 3.0 makes this possible by providing a<br>
driver mechanism and a new Sound control panel that allows the user to redirect sound<br>
to any available audio device. Audio card developers can license the Sound Manager 3.0<br>
extension and bundle it for distribution with their product. 
</p>
<p>
The Sound Manager previously supported only MACE audio compression at ratios of 3:1<br>
and 6:1.&nbsp;&nbsp;&nbsp;Sound Manager 3.0 goes beyond MACE to support any compressed audio<br>
format with the use of plug-in audio compression/decompression software (codecs).<br>
These are simply extension files that the Sound Manager recognizes and uses when it<br>
needs to play a compressed sound. In this way, applications can play compressed sounds<br>
seamlessly without being aware of the compressed format. 
</p>
<p>
Sound Manager 3.0 is much faster -- in many cases two to three times more efficient<br>
than previous versions. This means that your application can do more while sound is<br>
playing. Sound Manager 3.0 isalso more robust: many bugs have been fixed and a<br>
number of commonly requested features have been added. 
</p>
<p>
<b>SYSTEM REQUIREMENTS AND INSTALLATION</b><br>
Sound Manager 3.0 requires the Component Manager, so you must have either System<br>
7 with QuickTime or System 7.1. (The Component Manager comes with QuickTime and<br>
is built into System 7.1.) Sound Manager 3.0 supports all Macintosh models except for<br>
the "classic"-style hardware such as the Macintosh Plus, SE, and Classic. 
</p>
<p>
Installing Sound Manager 3.0 consists of dragging the Sound Manager extension and the<br>
new Sound control panel to your System Folder (where they will be placed in the<br>
appropriate folders) and rebooting. You should see Sound Manager 3.0's icon during<br>
startup. 
</p>
<p>
<b>WHAT'S NEW AND IMPROVED</b><br>
Here are some more details about new and improved features in Sound Manager 3.0. 
</p>
<p>
<b>Speed optimizations. </b>While Sound Manager 3.0 can play virtually any type of<br>
sound, it has been optimized for maximum playback efficiency with a number of<br>
common sound formats. So if you're worried about performance and want to minimize<br>
Sound Manager overhead, use one of these sound formats:
</p>
<ul>
<li>8-bit, mono, 22.254 kHz, full volume</li>
<li>8-bit, mono, 11.127 kHz, full volume</li>
</ul>
<p>
Increased efficiency is a major improvement in Sound Manager 3.0. In many cases, the<br>
Sound Manager will be two to three times more efficient, which allows applications to<br>
play more simultaneous sounds and do other work while sound is playing. 
</p>
<p>
For example, you can now play four channels of sound on a Macintosh LC, whereas in<br>
the past the Sound Manager would not allow this. QuickTime applications benefit from<br>
Sound Manager 3.0 by gaining an increase in the movie playback frame rate. The<br>
premiere multimedia platform is now QuickTime 1.6 and Sound Manager 3.0 on a<br>
Macintosh! 
</p>
<p>
<b>Sound quality. </b>Sound Manager 3.0 uses a fast linear interpolation for 11 kHz to 22<br>
kHz sample rate conversion, which makes audio sampled at 11 kHz sound much better.<br>
This improves the sound quality of many QuickTime movies without sacrificing<br>
performance. 
</p>
<p>
<b>16-bit sound. </b>Sound Manager 3.0 includes full support for 16-bit audio samples,<br>
including rate conversion, mixing, and decompression. It will automatically convert<br>
between 16-bit and 8-bit samples, so you never have to worry about the hardware<br>
you're running on. If your system has a 16- bit sound output device, you'll notice an<br>
increase in sound quality.
</p>
<p>
Until now, the value of the sampleSize field of the extended or compressed sound header<br>
has been 8 to denote the number of bits per sample. To play 16-bit sounds, specify the<br>
value 16 for the sampleSize field in the header, and the Sound Manager will treat the<br>
sound data as 16 bits per sample. 16-bit sounds are always in two's complement<br>
(signed) representation while 8-bit sounds are always in offset binary (unsigned)<br>
representation. For an example of how to fill out the extended sound header so that you<br>
can play 16-bit sounds, see Play16BitSound on this issue's CD. 
</p>
<p>
<b>Playing compressed sounds. </b>With Sound Manager 3.0, you can play sounds<br>
compressed with any algorithm when you use the CmpSoundHeader data structure. The<br>
CmpSoundHeader's old futureUse1 field is now the format field, which you can use to<br>
specify a 4-character OSType that identifies the compression algorithm. If the<br>
compressionID field of the CmpSoundHeader is set to the constant fixedCompression,<br>
the Sound Manager uses the OSType in the format field to find a codec that can<br>
decompress this type of audio. The example named PlayCompressedSound on the CD<br>
shows how to fill out the compressed sound header so that you can play compressed<br>
sounds. 
</p>
<p>
The SndPlayDoubleBuffer call has a similar interface. It accepts a new<br>
SndDoubleBufferHeader data structure that's identical to the previous one with the<br>
addition of a format field at the end. If thedbhCompressionID field is set to the constant<br>
fixedCompression, the format field is used to determine the codec to use to decompress<br>
the sound. Otherwise it will work as before. 
</p>
<p>
<b>Multiple sound channels. </b>The overall sound volume (amplitude) has been<br>
improved when multiple sound channels are being mixed. In the past the Sound<br>
Manager would average the amplitudes for all playing channels. With Sound Manager<br>
3.0, this averaging does not occur, which gives you better individual volume control.<br>
One possible disadvantage to this is that clipping can occur when many sounds of high<br>
amplitude are used. 
</p>
<p>
For those of you trying to synchronize multiple channels, syncCmd could never<br>
synchronize at a fine enough level. With Sound Manager 3.0, syncCmd synchronizes<br>
multiple channels so that independent sounds can be triggered at exactly the same time.<br>
The technique to synchronize multiple channels remains the same as before. See the<br>
PlayTwoSoundsSynched example on the CD. 
</p>
<p>
<b>Finding the sound header in a 'snd ' resource. </b>The 'snd ' resource is a<br>
cumbersome structure to parse. The old routine SetupSndHeader can be used to create<br>
this resource. A new routine, GetSoundHeaderOffset, has been created to locate the<br>
embedded sound header, which is used with the soundCmd or bufferCmd. The resulting<br>
offset is the number of bytes into the handle to the starting point of the sound header.<br>
The handle doesn't have to be locked to get this offset. See the PlaySndHandle example<br>
on the CD. 
</p>
<p>
<b>Volume control. </b>Two new sound commands, volumeCmd and getVolumeCmd, allow<br>
better control of a channel's output volume. You can use volumeCmd to set the volume.<br>
The param2 portion of the command contains a two-word value (four bytes) that<br>
represents a pair of volume levels; the high word is the level for the right output<br>
signal and the low word is the level for the left. A value of 0x0100 is full volume and<br>
0x0080 is half volume. For an example of setting the volume, see ChangeVolume on the<br>
CD. 
</p>
<p>
You can overdrive the volume if you want to amplify low signals. A value of 0x0200<br>
would be twice full volume. Furthermore, you can independently control the right and<br>
left volumes. The value 0x01000000 would send the output signal to the right, and<br>
0x00000100 would send it left. The value 0x00800100 would play out the right side<br>
at half volume and the left at full volume. 
</p>
<p>
The getVolumeCmd command returns the current volume. The param2 field should be a<br>
pointer to a long, similar to getAmpCmd. 
</p>
<p>
There are two new routines for controlling the volume of system beep sounds:<br>
GetSysBeepVolume and SetSysBeepVolume. 
</p>
<p>
<code>pascal OSErr GetSysBeepVolume(long *level)</code><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;= {0x203C,0x0224,0x0018,0xA800};</code><br>
<code>pascal OSErr SetSysBeepVolume(long level)</code><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;= {0x203C,0x0228,0x0018,0xA800};</code>
</p>
<p class="spacer">&nbsp;</p>
<p>
SysBeep will create a sound channel adjusted to the volume level last set by<br>
SetSysBeepVolume. This allows for system beep sounds to play back at a lower level<br>
than the rest of the machine, so you can hear a QuickTime movie running at full<br>
volume but hear alert beeps at a softer level. 
</p>
<p>
The older routines GetSoundVol and SetSoundVol were implemented as a Control call to<br>
the Sound Driver. Although we've made every effort to continue supporting them, they<br>
do not have the amount of accuracy that's available with two new Sound Manager<br>
routines GetDefaultOutputVolume and SetDefaultOutputVolume:
</p>
<p>
<code>pascal OSErr GetDefaultOutputVolume(long *level)</code><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;= {0x203C,0x022C,0x0018,0xA800};</code><br>
<code>pascal OSErr SetDefaultOutputVolume(long level)</code><br>
<code>&nbsp;&nbsp;&nbsp;&nbsp;= {0x203C,0x0230,0x0018,0xA800};</code>
</p>
<p class="spacer">&nbsp;</p>
<p>
The older routines used a 0-7 value range whereas the new Sound Manager has a<br>
0-0x0100 range.&nbsp;&nbsp;&nbsp;These new routines use the right/left volume pair as described<br>
above for volumeCmd. Each device has its own volume level. If the user changes the<br>
selected default device from the Sound control panel, that new device will use its own<br>
volume level, originally set by a previous call to SetDefaultOutputVolume. 
</p>
<p>
<b>Better stereo support. </b>Previous versions of the Sound Manager would drop the<br>
right channel of a stereo sound when playing on monophonic hardware, such as a<br>
Macintosh LC. Sound Manager 3.0 will automatically convert stereo sounds to mono on<br>
these machines without dropping the right channel, so you can hear what you've been<br>
missing. Certain older Macintosh models are also mono out of the internal speaker, but<br>
stereo if headphones are plugged in. Sound Manager 3.0 will automatically sense if a<br>
headphone is plugged in and do the correct conversion so that both the right and left<br>
channels of a stereo sound will always be heard. The only exception is the Macintosh<br>
IIfx, which requires you to manually select stereo or mono in the new Sound control<br>
panel. 
</p>
<p>
<b>Default output device. </b>Sound Manager 3.0 includes the concept of a default output<br>
device, set by the user in the new Sound control panel using the Sound Out panel. All<br>
sounds will be sent to this device unless an optional device was specified with<br>
SndNewChannel. The default device is generally the built-in sound hardware. The user<br>
can choose a new device (such as a sound card the user installed), and all sounds will<br>
then be routed to the chosen device. Adjusting the volume with either the control panel<br>
or the older call to SetSoundVol adjusts the volume of the default device. 
</p>
<p>
<b>Integration with QuickTime. </b>QuickTime 1.6 is aware of Sound Manager 3.0 and<br>
will take advantage of its new features if it's installed.
</p>
<ul>
<li>Option-clicking the volume control in QuickTime's movie controller<br>
allows you to overdrive the volume of the movie, giving a boost to low signals.</li>
<li>The track balance of an audio track can now be proportionally panned left<br>
and right, instead of just full left or full right. </li>
<li>QuickTime will query Sound Manager 3.0 for information on new<br>
compression types, allowing it to play compressed audio of any type. It will<br>
send 16-bit audio data directly to the Sound Manager, so QuickTime movies<br>
can play CD-quality audio.</li>
<li>QuickTime will use the Sound Manager to do rate conversion and mix<br>
multiple sound tracks into one sound for export as an AIFF file or 'snd '<br>
resource. </li>
</ul>
<p>
<b>Sound Driver compatibility. </b>The old Sound Driver, including the use of<br>
SoundBase, still works with Sound Manager 3.0, but we don't know how much longer<br>
this will be true. This depends entirely on changes in the hardware, not on the Sound<br>
Manager. If you're currently using the Sound Driver, Apple strongly encourages you to<br>
use the Sound Manager instead. Future changes in the sound architecture will be<br>
transparent to your application if you use the Sound Manager; they won't be if you<br>
continue to use the Sound Driver. 
</p>
<p>
<b>CPU loading. </b>The Sound Manager released with system software versions 6.0.7 and<br>
later contained support for CPU loading. This approach was found not to be very<br>
accurate, and is not supported in Sound Manager 3.0. Sound Manager 3.0 will return<br>
the constant 7% for any channel, no matter how it was created and initialized. The<br>
number 7% was chosen because some applications were expecting a nonzero value, and<br>
7% is about right for a Macintosh LC playing a single 11 kHz mono sound.&nbsp;&nbsp;&nbsp;Since the<br>
Sound Manager doesn't have true CPU loading checks, it's possible to run out of real<br>
time and thus overload the machine. Sound will then break up or even hang the system.<br>
This problem will be addressed in a future version of the Sound Manager. 
</p>
<p>
<b>Synth modes. </b>Previously the Sound Manager enforced a single synthesizer type to be<br>
allocated.&nbsp;&nbsp;&nbsp;Even if a given synthesizer type allowed for multiple channels, you still<br>
couldn't mix the types. For example, you couldn't use the wave table mode while any<br>
other mode was operating. This limitation has been eliminated. Any and all three types<br>
of channels (square, wave table, and sampled sound) can be opened and used at the same<br>
time. 
</p>
<p>
<b>Square wave sounds. </b>Unknown to most, the square wave synthesizer never<br>
produced true square waves. It was more like a modified sine wave. This has been<br>
corrected. As a result you'll notice that the Simple Beep sounds different. It can now be<br>
heard as it was originally designed to sound. 
</p>
<p>
<b>BUG FIXES AND FEATURE ENHANCEMENTS</b><br>
The following is a brief summary of bugs that have been fixed in Sound Manager 3.0.<br>
This is not a complete list. Its intention is to point out major areas of improvement<br>
that might affect a large number of applications. 
</p>
<p>
<b>Play from disk</b>
</p>
<ul>
<li>Some asynchronous file I/O problems while operating under the<br>
asynchronous SCSI Manager have been fixed. </li>
<li>Incorrect calculation of the audio selection for anything other than<br>
noncompressed 8-bit sounds has been fixed. This makes MACE and 16-bit data<br>
work with selections. </li>
<li>SndStartFilePlay can now handle 16-bit sounds and any compressed<br>
format. </li>
</ul>
<p>
<b>Sound Input Manager</b>
</p>
<ul>
<li>Sample rates greater than 32 kHz, which used to create overflows of the<br>
Fixed type and produce negative results, are now allowed.</li>
<li>Record to disk works better with large file system caches. Previously,<br>
during long disk writes to flush the file system's cache, incoming sound data<br>
would occasionally be lost. </li>
<li>When opening a sound input driver, the Sound Input Manager now checks<br>
for errors returned from the driver. </li>
</ul>
<p>
<b>Sound Output Manager</b>
</p>
<ul>
<li>Sample rates greater than 32 kHz, which used to create overflows of the<br>
Fixed type and produce negative results, are now allowed.</li>
<li>MoveHHi has been patched to avoid stack-into-heap problems during<br>
sound interrupts. </li>
<li>There are fewer clicks and pops, especially when opening a sound channel.</li>
<li>When playing multiple channels of sound using the bufferCmd, the Sound<br>
Manager will no longer mix in random amounts of silence, which caused<br>
sounds to be discontinuous and get out of sync. </li>
<li>Stopping a sound or starting a new one sometimes caused the channel to<br>
fail to produce any new sounds. This has been fixed. </li>
<li>The ampCmd works for all types of sound channels (square, wave table,<br>
and sampled). </li>
<li>Loop points now work on any type of sound, including 16-bit, stereo, and<br>
compressed sounds. </li>
<li>Linear interpolation is now performed across separate buffers, so you can<br>
play a set of sounds without getting a click between sounds. </li>
<li>Machines with the Macintosh II ROM (II, IIx, IIcx, SE/30) could lose<br>
sound interrupts after playing for long periods of time. This has been fixed. </li>
</ul>
<p>
<b>SOUNDING OFF</b><br>
Sound Manager 3.0 is a vast improvement over the old Sound Manager and will enhance<br>
QuickTime applications and other applications that use sound. So check it out; from the<br>
system beep to sophisticated movies, we're sure you'll notice the difference. 
</p>
<h2>ADVANCED FEATURES</h2>
<p>
An important feature of Sound Manager 3.0 is the ability to play through alternate<br>
sound output devices installed in your system. These devices will be available from<br>
third-party developers. The Sound Manager can take advantage of specialized hardware<br>
features such as sample rate conversion and audio mixing. If such features are<br>
available in the hardware (such as better sample rate conversion done by a DSP),<br>
theSound Manager will allow this support to be passed off to the hardware for better<br>
quality and efficiency.
</p>
<p>
Support for plug-in audio codecs is another significant new feature. This allows the<br>
Sound Manager to support new compression methods, which become desirable now that<br>
we're supporting 16-bit data.
</p>
<p>
Sound Manager 3.0 was developed by&nbsp;&nbsp;Jim Reekes and Kip Olson. Kip wants everyone to<br>
know that the original design document describing the Sound Manager back in 1987<br>
was&nbsp;&nbsp;titled "Software Architecture for a Device-Independent Sound Manager," which<br>
can be abbreviated as SADISM. This explains&nbsp;&nbsp;a lot, doesn't it?*
</p>
<p>
Sound Manager 3.0 has been made widely available. The extension, control panel, and<br>
related files are not only on this issue's CD but are also included in the Sound Manager<br>
Developer's Kit v. 3.0 available from APDA, in Hardware System Update 2.0, with<br>
sound products from third parties, and on various electronic bulletin boards (such as<br>
CompuServe and America Online). Sound Manager 3.0 is built into some new Macintosh<br>
systems; you can tell it's there if Sound Out is listed in the Sound control panel. *
</p>
<p class="spacer">&nbsp;</p>
<p>
JIM REEKES studied music composition and theory in college, never taking a single<br>
computer science or engineering class because he knew they would pollute his brain.<br>
He taught himself programming, beginning with the Apple II and then on the Macintosh<br>
128K in 1984. He began working in Apple's Developer Technical Support group in<br>
1988. He took over responsibility for the Sound Manager during System 7 beta (so<br>
you can't blame that one on him!) and recently finished Sound Manager 3.0, a complete<br>
rewrite. If there's one thing he has learned while at Apple, it's that there's a fine line<br>
between amazing insight and having a bad attitude. Jim has been collecting progressive<br>
rock and electronic music recordings since the 1970s. He grew up in Pomona,<br>
California, during the 1960s and can remember when Frank Zappa performed in local<br>
bars on Mission Blvd. and Cucamonga was a vineyard. He wishes programming didn't<br>
burn out his creative drive so that he could spend more time in his MIDI studio. *
</p>
<p>
Thanks to Ray Chiang and Bryan ("Beaker") Ressler for reviewing this column.<br>
Special thanks to Kip Olson. *
</p>
</body>
</html>
