<html>
<head>
<!-- Article ID: 19 - Extracted from develop-1994 -->
<!-- on 2024-05-24 by Giorgio Ferrara - giorgio<dot>ferrara<at>gmail<dot>com -->
<!-- The content is protected by the copyright of its respective owners -->
<title>June 94 - Giving Users Help with Apple Guide</title>
<link href="../common/styles/main.css" rel="stylesheet" type="text/css">
</head>
<body>
<h2>Giving Users Help with Apple Guide</h2>
<h2>JOHN POWERS</h2>
<p>
<img src="img/161.gif" width="180 px"></img>
</p><p class="spacer">&nbsp;</p>
<p>
<i>A positive user experience means getting the task done with a minimum of hassle. But</i><br>
<i>as applications engage in the features race, their complexity increases as well, leading</i><br>
<i>to increased user frustration. One solution is to add a powerful help system that can</i><br>
<i>guide the user through a task. The new Apple Guide system makes this chore easier</i><br>
<i>than you might think.</i>
</p>
<p class="spacer">&nbsp;</p>
<p>
Someone has decided that your application needs help. Maybe it's a little heavy on the<br>
features, and Marketing is afraid that the user will be overwhelmed. Perhaps your<br>
user studies have shown that users can really benefit from some coaching when<br>
learning your interface. Or the finance experts have figured out that you can save a lot<br>
of money on printing and user support costs by putting help on the screen rather than<br>
in printed manuals. And yesterday the CEO declared that your product must win a gold<br>
medal in customer satisfaction.
</p>
<p>
It<i> can</i> be done. 
</p>
<p>
This article tells you how to add Apple Guide, a new kind of help system, to your<br>
application with a pain and suffering level that you can control, ranging from almost<br>
nothing to only a tingle.
</p>
<p>
The article doesn't tell you what help your application should provide; that's up to<br>
your software designer, technical writer, instructional designer, interface designer,<br>
and whoever else likes to stir the design pot. Once you've decided what help you want<br>
and the technical writer has written it using the Apple Guide authoring tool, you<br>
integrate it. That's where this article -- and this issue's CD, which contains a sample<br>
program with Apple Guide integrated -- comes in.
</p>
<h2>WHAT IS APPLE GUIDE?</h2>
<p>
Apple Guide is a new kind of help system that acts as an interactive, task-oriented<br>
guide and will be available to all applications systemwide as of System 7.5. Apple<br>
Guideis based on more than two years of research on people's need for help while<br>
usingtheir computers. Several key findings of this research underlie the Apple Guide<br>
design:
</p>
<ul>
<li>Users are task-oriented. </li>
<li>Users seek help when they're frustrated doing a task.</li>
<li>Help should be an interactive guide to accomplishing a task, not a static<br>
document. </li>
</ul>
<p>
The paradigm is simple:
</p>
<ol>
<li>The user has a task to accomplish.</li>
<li>The user becomes frustrated when an obstacle prevents completion of the<br>
task.</li>
<li>The user asks for help.</li>
</ol>
<p>
Traditional help requires users to go to a printed or on-screen document to identify<br>
the problem in the context of the documentation. This in itself can become a<br>
frustration. Users would rather have someone (or something) guide them through the<br>
obstacle. That's what Apple Guide does: it acts as an interactive, task-oriented guide.
</p>
<p>
When users ask for help, the first thing they see is the<i>access window</i> , which provides<br>
three ways of selecting the help topic. Once the user selects the help topic, the access<br>
window is replaced by the<i>presentation window</i> , which presents the help topic as a<br>
series of panels containing text, graphics, QuickTime movies, and controls. (Note that<br>
in an application in which Apple Guide has been fully integrated, the help topic can be<br>
preselected for the user based on context -- more on this later.) To experience Apple<br>
Guide for yourself, try out the application called MoGuide on this issue's CD. 
</p>
<p>
Apple Guide is implemented as a system extension (see "What Systemwide Help Means"<br>
for some ramifications of this) that uses a guide database file to drive its interaction<br>
with the user, as depicted in Figure 1. The database file, written using the Apple Guide<br>
authoring tool, contains multimedia help content and instructions on how to interact<br>
with the user. The delivery engine is in the system extension, which contains two<br>
components: a stay-resident portion and a launch-as-needed application portion. With<br>
a RAM footprint of less than 20K, the stay-resident portion installs patches at startup<br>
time, manages the Help menu (the one labeled with a question mark in a balloon), and<br>
starts up Apple Guide from the Help menu. The applicationportion is loaded and run<br>
when help is being delivered; with a RAM footprint of 400K,it's launched as a faceless<br>
background application in its own heap. The Apple Guide system extension and several<br>
guide databases will be provided as part of System 7.5.
</p>
<p>
<img src="img/162.gif" width="590 px"></img>
</p>
<p>
<b>Figure 1. </b>How Apple Guide works
</p>
<h2>TO INTEGRATE OR NOT TO INTEGRATE?</h2>
<p>
You can put Apple Guide to work for you whether or not you decide to integrate it into<br>
your application. However, as in life, the level of pain you choose determines the<br>
amount of gain.
</p>
<p>
The easiest way to add Apple Guide to an application is to place an Apple Guide database<br>
file in the same folder as the application. No coding changes are necessary; the<br>
integration is automatic. The Apple Guide extension adds the database to the<br>
application's Help menu and launches the database when the user chooses it. 
</p>
<p>
Here's what Apple Guide delivers without any changes to your application:
</p>
<ul>
<li>help initiated from the Help menu</li>
<li>interactive delivery of multimedia help content</li>
<li>the ability to mark static interface objects, or dynamic interface objects<br>
identified using the Object Support Library (OSL), to draw the user's<br>
attention to them</li>
<li>elementary to intermediate context sensitivity</li>
</ul>
<p>
This is a lot of help in itself. But if you want more control over Apple Guide, you'll<br>
need to make code changes in your application. Here's what those changes can add:
</p>
<ul>
<li>information about where the user is in the help system</li>
<li>more direct control over what help the user receives and responsiveness<br>
to the user's context</li>
<li>help initiated from any control -- including buttons, lists, and special<br>
keys -- and from application menus</li>
<li>guide databases with your own creator, type, and document icons</li>
<li>the ability to use databases located in a folder separate from the<br>
application</li>
</ul>
<p>
If you want the gain and you're ready for the (slight) pain, read on.
</p>
<p>
To communicate with Apple Guide from your application, you use standard, trap-based<br>
function calls. The function calls enable your application to get information about<br>
Apple Guide, start up Apple Guide, respond to Apple Guide, modify help content, and<br>
quit Apple Guide. I'll explain how to do each of these in the sections that follow. You<br>
might want to examine the source code for the sample program MoGuide on this issue's<br>
CD to see the function calls used in context. Then you can try integrating Apple Guide<br>
into your own application. 
</p>
<h2>GETTING INFORMATION ABOUT APPLE GUIDE</h2>
<p>
Your application can find out a number of different things about Apple Guide: whether<br>
it's installed, what its status is, whether an Apple Guide database is available, the<br>
number and characteristics of guide databases available, and whether your own guide<br>
database is open.
</p>
<p>
<b>IS APPLE GUIDE INSTALLED?</b><br>
Before you do anything with the Apple Guide extension, you need to determine whether<br>
it's installed. The following code shows how:
</p>
<pre>long    result=0;
OSErr   err = Gestalt(gestaltHelpMgrAttr, &amp;result);
if (err==noErr &amp;&amp; (result &amp; (1 << gestaltAppleGuidePresent)))
    ;   // Apple Guide is available.
else
    ;   // Apple Guide is not available.</pre>
<p class="spacer">&nbsp;</p>
<p>
<b>WHAT'S THE STATUS OF APPLE GUIDE?</b><br>
Once you've determined that Apple Guide is installed, you can get more information<br>
about its state -- for example, is it active (displaying a help window)? If it is, which<br>
help window is being displayed?&nbsp;&nbsp;&nbsp;The latter information can be saved and used to<br>
restart users at the point where they left the help system. 
</p>
<p>
The AGGetStatus function returns whether Apple Guide is active (kAGIsActive),<br>
sleeping (kAGIsSleeping), or not running (kAGIsNotRunning). In the active state, help<br>
is being provided (a guide database is open). In the sleeping state, the Apple Guide<br>
background application is loaded and running, but no help is being provided (no guide<br>
database is open). In the not-running state, the application portion of Apple Guide isn't<br>
loaded or running. 
</p>
<p>
If Apple Guide is active, you can further determine whether the access window or the<br>
presentation window is showing. For example:
</p><p class="spacer">&nbsp;</p>
<pre>if (AGGetActiveWindowKind()==kAGAccessWindow)
    ;// Apple Guide access window is showing.
else if (AGGetActiveWindowKind()==kAGPresentationWindow)
    ;// Apple Guide presentation (topic) window is showing.
else
    ;// No window is showing; Apple Guide is sleeping or not running.</pre>
<p class="spacer">&nbsp;</p>
<p>
Be sure you've determined that Apple Guide is installed before invoking AGGetStatus or<br>
any other Apple Guide function. Otherwise, if Apple Guide isn't present, you'll get an<br>
unimplemented trap error. 
</p>
<p>
<b>IS AN APPLE GUIDE DATABASE AVAILABLE?</b><br>
You can find out whether an Apple Guide database is available to the current<br>
(frontmost) application, and furthermore, whether a specific type of guide database is<br>
available. (There are two file types and five database types, classified according to the<br>
type of help information they contain; see "About Apple Guide Database Files" for a<br>
rundown of the types.)
</p>
<p>
The AGGetAvailableDBTypes function returns bits set to correspond to the various<br>
types of guide databases available to (in the same folder as) the frontmost application.
</p><p class="spacer">&nbsp;</p>
<pre>enum AGDBTypeBit        // To test against AGGetAvailableDBTypes
{
    kAGDBTypeBitAny =           0x00000001,
    kAGDBTypeBitHelp =          0x00000002,
    kAGDBTypeBitTutorial =      0x00000004,
    kAGDBTypeBitShortcuts =     0x00000008,
    kAGDBTypeBitAbout =         0x00000010,
    kAGDBTypeBitOther =         0x00000080
};</pre>
<p>
The kAGDBTypeBitAny bit will be true if the application has any Apple Guide database<br>
file available. Thus, the following statement will test whether any guide database is<br>
available:
</p>
<pre>if (AGGetAvailableDBTypes() &amp; kAGDBTypeBitAny)
    ;   // Some kind of database is available</pre>
<p>
You can simlarly use the other constants to test the availability of specific types of<br>
Apple Guide databases. 
</p>
<p>
<b>HOW MANY AND WHICH GUIDE DATABASES ARE AVAILABLE?</b><br>
The tests described in the preceding section apply only to guide database files or their<br>
aliases in the same folder as the application. You can also find files outside the<br>
application's folder, by using the AGFile library that's included on this issue's CD. This<br>
library doesn't use or require the Apple Guide system extension and offers access to<br>
information about Apple Guide database files.&nbsp;&nbsp;With the AGFile library, you can count<br>
and find guide databases of specific file and database types.&nbsp;&nbsp;&nbsp;Once you've found a<br>
database, you can get information about it. For example, the following code counts the<br>
number of main guide database files (those that aren't mix-in files) of type<br>
kAGFileDBTypeHelp in a specified volume and directory:
</p>
<pre>AGFileCountTypeguideFileCount;
AGFileDBType databaseType=kAGFileDBTypeHelp;
Boolean wantMixin=false;</pre>
<pre>guideFileCount = AGFileGetDBCount(vRefNum, dirID, databaseType,
    wantMixin);</pre>
<p>
You can get the FSSpec for a particular type of Apple Guide database file in a specified<br>
volume and directory as follows:
</p>
<pre>AGFileCountTypeguideFileCount;
AGFileDBType databaseType=kAGFileDBTypeOther;
Boolean wantMixin=false;
short dbIndex=1;
FSSpec dbSpec;</pre>
<pre>err = AGFileGetIndDB(vRefNum, dirID, databaseType, wantMixin,
        dbIndex, &amp;dbSpec);</pre>
<p>
The AGFileGetIndDB call will return noErr and the FSSpec for the database file if it's<br>
present.&nbsp;&nbsp;&nbsp;Increment dbIndex to find additional guide databases of the same type. 
</p>
<p>
Listing 1 shows how to accumulate a list of FSSpecs for all the guide databases in a<br>
specified volume and directory. 
</p><p class="spacer">&nbsp;</p>
<pre>Listing 1. Accumulating FSSpecs for guide databases
AGFileCountType     guideFileCount;
AGFileDBType        databaseType=kAGFileDBTypeAny;
Boolean             wantMixin=false;
FSSpec              dbSpec;
Handle              hFileList;

// See how many guide files are available.
guideFileCount = AGFileGetDBCount(vRefNum, dirID, databaseType,
    wantMixin);
if (guideFileCount&gt;0) {
    // Create a new list of file FSSpecs.
    hFileList = NewHandle(guideFileCount * sizeof(FSSpec));
    if (hFileList!=nil) {
        // Get each file and add to list.
        for (short i=1; i&lt;=guideFileCount; i++) {
            if (AGFileGetIndDB(vRefNum, dirID, databaseType,
                    wantMixin, i, &amp;dbSpec)==noErr) {
                ((FSSpec*)(*hFileList))[i-1] = dbSpec;
            }   // if (...
        }   // for (short...
    }   // if (hFileList...</pre>
<p class="spacer">&nbsp;</p>
<p>
<b>Listing 1. </b>Accumulating FSSpecs for guide databases
</p>
<p>
Once you have the FSSpec for a database file, you can ask for more information. For<br>
example, the following code can be used to get the version and menu item name for a<br>
database:
</p><p class="spacer">&nbsp;</p>
<pre>AGFileMajorRevType  majorRev;
AGFileMinorRevType  minorRev;
Str255              menuName;

AGFileGetDBVersion(&amp;fileSpec, &amp;majorRev, &amp;minorRev);
AGFileGetDBMenuName(&amp;fileSpec, menuName);</pre>
<p class="spacer">&nbsp;</p>
<p>
<b>IS YOUR GUIDE DATABASE OPEN?</b><br>
As mentioned earlier in "What Systemwide Help Means," you can't assume your guide<br>
database is always open, even if the user invoked it from within your application. To<br>
cope with this fact of life, your application should call the AGIsDatabaseOpen function<br>
when it's switched from background to foreground, passing in the database's reference<br>
number, to see if its guide database is still open. 
</p>
<pre>if (AGIsDatabaseOpen(myAGRefNum))
    ;   // The database with myAGRefNum is open.
else
    ;   // The database with myAGRefNum isn't open; someone else
closed it.</pre>
<p class="spacer">&nbsp;</p>
<p>
If AGIsDatabaseOpen is true, you can also assume that Apple Guide is active. If<br>
AGIsDatabaseOpen is false and you haven't explicitly closed your database, another<br>
application or the user has closed it. 
</p>
<p>
<b>STARTING UP APPLE GUIDE</b><br>
You can start up Apple Guide with either the first available guide database or one you<br>
specify. You can also control the initial view the user sees, choosing from seven<br>
different options. In this initial view you can present the user with a list of topics<br>
related to the context, or you can skip the initial view and instead take the user<br>
directly to a help topic. 
</p>
<p>
<b>DEFAULT STARTUP</b><br>
The default startup, the quickest and easiest way to start up Apple Guide, opens the<br>
first available guide database. The database must be in the same folder as your<br>
application (the Finder is an exception -- its guide databases are in the Extensions<br>
folder). The mechanism is similar to what happens when the user selects an item from<br>
the Help menu.
</p>
<p>
The default startup is accomplished by calling the AGOpen function with the kAGDefault<br>
flag:
</p>
<pre>err = AGOpen(kAGDefault, 0, nil, &amp;myAGRefNum);</pre>
<p>
A reference for the database that was opened is returned in myAGRefNum. You must use<br>
this reference when you close the database. 
</p>
<p>
Apple Guide starts up with the frontmost application's guide database and the startup<br>
conditions specified in the database. If more than one Apple Guide database is available<br>
for the application, the first database of type kAGFileDBTypeHelp is used. If no<br>
database is present, the error code kAGErrDatabaseNotAvailable is returned and Apple<br>
Guide doesn't start up. 
</p>
<p>
<b>DATABASE OTHER THAN THE DEFAULT</b><br>
An application can also open a specific guide database when it starts up Apple Guide, by<br>
specifying the FSSpec for the database in the AGOpen call:
</p>
<pre>err = AGOpen(&amp;myGuideDatabaseFSSpec, 0, nil, &amp;myAGRefNum);</pre>
<p>
See the earlier section "How Many and Which Guide Databases Are Available?" for a<br>
suggested way to get a database FSSpec. 
</p>
<p>
<b>VIEW OTHER THAN THE DEFAULT</b><br>
Apple Guide offers seven startup view options. This is normally controlled by the guide<br>
database; however, these defaults can be overridden with a startup function parameter.<br>
For example:
</p>
<pre>err = AGOpenWithView(&amp;myGuideDatabaseFSSpec, 0, nil, kAGViewIndex,
          &amp;myAGRefNum);</pre>
<p class="spacer">&nbsp;</p>
<p>
Six of the possible startup views are listed below. These views, which are access<br>
windows, are shown in Figure 3. Startup view number 7 is the topic or presentation<br>
window view, which is started with a different function call (described below in<br>
"Going Directly to a Topic"). 
</p>
<pre>enum
{
    kAGViewFullHowdy =      1,      // Full-window howdy
    kAGViewTopicAreas =     2,      // Full-window topic areas
    kAGViewIndex =          3,      // Full-window index terms
    kAGViewLookFor =        4,      // Full-window look-for (search)
    kAGViewSingleHowdy =    5,      // Single-list howdy
    kAGViewSingleTopics =   6       // Single-list topics
};</pre>
<p>
Since almost all guide databases contain multiple topic areas, they usually start up<br>
with the kAGViewFullHowdy view. If you specify a kAGViewSingleHowdy or<br>
kAGViewSingleTopics view for these kinds of guide databases, only the topics for the<br>
first topic area will be shown.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</p>
<p>
<img src="img/163.gif" width="600 px"></img>
</p>
<p>
View 1: Full-window howdy 
</p>
<p>
<img src="img/164.gif" width="600 px"></img>
</p>
<p>
View 2: Full-window topic areas&nbsp;&nbsp;
</p>
<p>
<img src="img/165.gif" width="600 px"></img>
</p>
<p>
View 3: Full-window index terms&nbsp;&nbsp;
</p>
<p>
<img src="img/166.gif" width="600 px"></img>
</p>
<p>
View 4: Full-window look-for&nbsp;&nbsp;&nbsp;
</p>
<p>
<img src="img/167.gif" width="401 px"></img>
</p>
<p>
View 5: Single-list howdy&nbsp;&nbsp;&nbsp;
</p>
<p>
<img src="img/168.gif" width="404 px"></img>
</p>
<p>
View 6: Single-list topics
</p>
<p>
<b>Figure 3. </b>Six startup view options
</p>
<p>
<b>&nbsp;PRIMING A SEARCH</b><br>
&nbsp;An application can start up Apple Guide (or restart it if it's already running) in the<br>
look-for view with a list of context-sensitive topics that match a search string (a<br>
Str255). To initiate a context-sensitive search, use the AGOpenWithSearch function<br>
and include a look-for search string as follows:
</p>
<pre>err = AGOpenWithSearch(&amp;myGuideDatabaseFSSpec, 0, nil,
        mySearchString, &amp;myAGRefNum);</pre>
<p>
<b>&nbsp;GOING DIRECTLY TO A TOPIC</b><br>
&nbsp;Sometimes you may want to initiate help when the user clicks a Help button in a dialog<br>
or Option- clicks an interface object. In these cases, you have a good idea of the context<br>
and can bypass the Apple Guide access window, going directly to the presentation<br>
window with the selected help topic.&nbsp;&nbsp;&nbsp;Here's how:
</p>
<pre>err = AGOpenWithTopic(&amp;myGuideDatabaseFSSpec, 0, nil, myTopicId,
        &amp;myAGRefNum);</pre>
<p>
&nbsp;The presentation window will appear with the first panel of the topic. 
</p>
<p>
&nbsp;The Apple Guide authoring tool usually handles topics by name and quietly assigns a<br>
topic ID number when the database is compiled. However, you can override this<br>
automatic assignment by specifying your own topic ID. See the authoring tool<br>
documentation for information on how to assign your own topic ID numbers.&nbsp;&nbsp;&nbsp;&nbsp;
</p>
<p>
<img src="img/169.gif" width="402 px"></img>
</p>
<p>
<b>&nbsp;Figure 4. </b>Controls in a presentation window
</p>
<h2>&nbsp;RESPONDING TO APPLE GUIDE</h2>
<p>
&nbsp;The author of an Apple Guide database file can initiate a number of different kinds of<br>
events to which your application may need to respond. These include attaching Apple<br>
events to controls in help topics, drawing coach marks on dynamic interface objects,<br>
sending Apple events when certain panels appear, and using context checks to<br>
determine whether a presentation panel should be shown or skipped. 
</p>
<p>
<b>&nbsp;RECEIVING THE AUTHOR'S EVENTS</b><br>
&nbsp;A help author can attach an Apple event to any control in an Apple Guide presentation<br>
window. The controls can be Macintosh buttons, checkboxes, radio buttons, or Apple<br>
Guide buttons (the last two types of controls are illustrated in Figure 4). The author's<br>
action specification for these controls will contain
</p>
<ul>
<li>the target for the action (usually an application signature)</li>
<li>the Apple event class</li>
<li>the Apple event ID</li>
<li>the optional key</li>
<li>optional data for the optional key</li>
</ul>
<p>
The action might be directed to Apple Guide -- for instance, to start up another<br>
presentation window, to return to the access window, or to go to another panel in the<br>
same topic. The action can also be directed to your application; in that case, the target<br>
is your application signature, and the Apple event class and event ID are ones for<br>
which you've installed a handler. The content of the optional key/data field can be<br>
anything; how it's used is up to the application developer. Apple Guide extracts the<br>
optional data field, calculates its size in bytes, calls AEPutParamPtr with a descriptor<br>
type of typeChar, and sends the Apple event.&nbsp;&nbsp;To receive the action, install an Apple<br>
event handler for the class and event ID. Your handler can get the optional data<br>
parameter using your key. 
</p>
<p>
There is no reply to this event. If you want to reply, see the section "Responding to<br>
Context Checks."
</p>
<p>
<b>PROVIDING OBJECT LOCATION FOR COACH MARKS</b><br>
Coach marks are circles, X's, underlines, and arrows that can be drawn on interface<br>
objects to direct the user's attention to them, as illustrated in Figure 5. Using such<br>
marks has been shown in tests to be much more effective than putting drawings of the<br>
objects into the help content (users tend to click on the drawing, not the real thing).<br>
The Apple Guide authoring tool provides a fairly complete set of instructions to mark<br>
many common interface objects, such as the following:
</p>
<ul>
<li>menu titles and items</li>
<li>windows and any coordinates relative to a window</li>
<li>window elements such as close boxes, size boxes, titles, and scroll bars</li>
<li>items that have a help balloon "hot rectangle"</li>
<li>dialog items</li>
</ul>
<p>
<img src="img/170.gif" width="600 px"></img>
</p>
<p>
<b>&nbsp;Figure 5. </b>Coach marks
</p>
<p>
These are all relatively static elements with locations that can be found by Apple<br>
Guide's marking facility. Some interface objects, on the other hand, are dynamically<br>
located at locations known only to the application. If you've identified a dynamic<br>
interface object using the Object Support Library (OSL), you can use Apple Guide's<br>
built-in OSL coach-marking facility to locate and mark the object.&nbsp;&nbsp;&nbsp;See the<br>
documentation for the Apple Guide authoring tool for details.
</p>
<p>
If you want to mark dynamic interface objects and you're not using the OSL, Apple<br>
Guide provides another method for you to use. In this method a handler installed by<br>
Apple Guide calls your application asking for the rectangle of a named object. To use<br>
this method, your application must install a coach handler that takes the object name<br>
and replies with the object rectangle in global coordinates. Here's an example. First,<br>
you install the coach handler:
</p>
<pre>AGCoachRefNum myAGCoachRefNum;
OSErr err = AGInstallCoachHandler(MyCoachReplyProc, myRefCon,
                &amp;myAGCoachRefNum);</pre>
<p>
The prototype for a CoachReplyProc is as follows:
</p>
<pre>typedef pascal OSErr (*CoachReplyProcPtr) (Rect* pRect, Ptr name,
                      long refCon);</pre>
<p>
Apple Guide will invoke your CoachReplyProc with the name (a null-terminated<br>
C-string) and myRefCon from the AGInstallCoachHandler call. Set the value of pRect to<br>
the object rectangle in global coordinates. The following is an example of a<br>
CoachReplyProc. Apple Guide will draw the coach mark around, under, or through the<br>
rectangle provided in the reply. 
</p>
<pre>pascal OSErr MyCoachReplyProc(Rect* pRect, Ptr name, long refCon)
{
    // Look up the name and return the rect in global coordinates.
    OSErr err = MyRectForName(pRect, name);
    return err;
}</pre>
<p>
Coach handlers persist across the opening and closing of guide databases. However, you<br>
must remove the coach handler when your application quits. Use the AGCoachRefNum<br>
that was returned to you in the AGInstallCoachHandler call. 
</p>
<pre>OSErr err = AGRemoveCoachHandler(&amp;myAGCoachRefNum);</pre>
<p>
<b>RESPONDING TO THE USER'S HELP FOCUS</b><br>
You can get Apple Guide to notify your application whenever a particular panel is being<br>
displayed (in other words, whenever it's the user's help focus) by taking advantage of<br>
Apple Guide's authorable actions. To do this, use the authoring tool to attach an Apple<br>
event of your choosing to an "On Panel Show" or "On Panel Hide" action. When the panel<br>
is shown or goes away, the Apple event is sent to your application, which can then<br>
respond appropriately. For example, it might be useful to attach an Apple event to an<br>
"On Panel Show" action for the last panel in a series of instructions, to signal that the<br>
user has reached the end. See the authoring tool documentation for information on how<br>
to attach an Apple event to a panel action. 
</p>
<p>
<b>RESPONDING TO CONTEXT CHECKS</b><br>
Apple Guide can use context checks to get information about the user's environment<br>
and, based on that, to decide which panels to show in a presentation window. This<br>
enables the Apple Guide author to tailor the help to the user's current context. It gives<br>
an individualized feel to the instruction and avoids requiring the user to navigate<br>
through irrelevant information, things that users appreciate a lot. When you integrate<br>
Apple Guide, the user's context will usually be your application. The help author will<br>
want to use information from your application to determine what help the user needs. <br>
You'll need to respond to these context checks by installing an Apple event handler,<br>
processing the context check, and returning true or false. 
</p>
<p>
Here's how it works: An author attaches conditions to selected panels. These conditions<br>
can be based on context checks or on user controls in other panels. While the user is<br>
reading the content of a presentation window, Apple Guide looks ahead to see which<br>
panel to show next. It evaluates the conditions, including context checks, attached to<br>
each panel. When Apple Guide evaluates a context check, it invokes the Apple event<br>
handler for the context check. The results of the evaluation based on the context check<br>
determine whether the panel should be shown or skipped. 
</p>
<p>
Context checks are usually encapsulated as Apple Guide "external modules" andattached<br>
to a database. An external module is a code resource that executes inresponse to the<br>
query from Apple Guide. Creating and using external modules is outside the scope of<br>
this article, but see theTContext::ReplyToContext function in the sample code for an<br>
example of how to handle context checks from within your application. 
</p>
<p>
Apple Guide handles context-check queries similarly to coach-mark queries. You<br>
install a context- check handler and Apple Guide calls it. First, the installation of the<br>
handler:
</p>
<pre>AGContextRefNum myAGContextRefNum;
OSErr err = AGInstallContextHandler(MyContextReplyProc, eventID,
myRefCon,
                &amp;myAGContextRefNum);</pre>
<p>
The prototype for a ContextReplyProc is as follows:
</p>
<pre>typedef pascal OSErr (*ContextReplyProcPtr)(Ptr pInputData,
                      Size inputDataSize, AEEventID eventId,
                      Ptr *ppOutputData, Size *pOutputDataSize,
                      long refCon);</pre>
<p>
When Apple Guide needs to do a context check, it invokes your callback with the<br>
context-check inputData and eventId. It also passes the refCon that you provided in the<br>
AGInstallContextHandler call. The ContextReplyProc should use NewPtr to create a<br>
storage area for a short, set *ppOutputData to the value of the pointer, and set<br>
*pOutputDataSize to sizeof(short). Always return a pointer to a short. Apple Guide<br>
will dispose of the pointer. 
</p>
<p>
You're probably wondering why we didn't pass a Boolean instead of *ppOutputData and<br>
*pOutputDataSize. The reason is that the context reply is a special case of a more<br>
general reply mechanism, which I'm not going to go into here. Just take my word for it<br>
-- it has to be this way. 
</p>
<p>
Context handlers persist across the opening and closing of help databases. However,<br>
you must remove the context handler when your application quits. Use the<br>
AGContextRefNum that was returned to you in the AGInstallContextHandler call. 
</p>
<pre>OSErr err = AGRemoveContextHandler(&amp;myAGContextRefNum);</pre>
<p>
If you just want to field Apple events that don't require a reply, see the earlier section<br>
"Receiving the Author's Events."
</p>
<h2>MODIFYING HELP CONTENT</h2>
<p>
So far, we've talked only about main guide database files, the standalone files that<br>
support all or part of an application. You can modify the content of a main guide<br>
database by mixing in a mix-in guide database. 
</p>
<p>
When a field upgrade involves new features and you don't want to release a revised<br>
guide database, you can use Apple Guide's mix-in files to add help content to the main<br>
guide database file. The mix- in files don't appear in the Help menu. When Apple Guide<br>
starts up, each mix-in file is merged with a main guide database file of the<br>
corresponding DBType. Multiple mix-in files can be mixed in.
</p>
<p>
The process is automatic, but the guide database author can control it by using Gestalt<br>
selectors.&nbsp;&nbsp;&nbsp;Each guide database file contains three Gestalt selectors. The selectors must<br>
evaluate to true in order for a main database to appear in the Help menu or a mix-in<br>
database to be mixed in. The Gestalt selectors in a given file are combined using<br>
Boolean OR logic. Empty Gestalt selectors are ignored. If all Gestalt selectors are<br>
empty, the file is unconditionally accepted. 
</p>
<p>
There's a really cool way for the programmer to handle this. If the first Gestalt<br>
selector is the literal 'QLfy', Apple Guide will call a code resource of type 'QLfy' in the<br>
database file. If the code resource returns true, the database file will be mixed in; if it<br>
returns false, it won't be. The prototype for the code resource is as follows:
</p>
<pre>short(*QualifyFuncType)(void);</pre>
<p>
The AGFile library described earlier provides accessor functions that you can use to<br>
get the selectors and their values from any database. Only the authoring tool can change<br>
the selectors, however. 
</p>
<h2>QUITTING APPLE GUIDE</h2>
<p>
When you've finished using a guide database, use the AGClose function with a pointer to<br>
the AGRefNum for the database. 
</p>
<pre>err = AGClose(&amp;myAGRefNum);</pre>
<p>
This will close the database and leave Apple Guide running in the background. When<br>
you've finished with Apple Guide, use the AGQuit function. 
</p>
<pre>err = AGQuit();</pre>
<p>
This will make Apple Guide quit. If you attempt to call AGQuit without first closing the<br>
database, you'll get a kAGErrDatabaseOpen error. 
</p>
<p>
If you start Apple Guide from your application, you should make it quit. Otherwise, the<br>
Apple Guide background application and help window will hang around without your<br>
application and consume system resources. This persistence is a result of the fact that<br>
Apple Guide is available systemwide.&nbsp;&nbsp;&nbsp;Even if the user quits Apple Guide by clicking<br>
the Cancel button or the close box, you must still balance every AGOpen function with<br>
an AGClose.
</p>
<h2>STEPS TOWARD INTEGRATION</h2>
<p>
Now you know what's involved in integrating Apple Guide into your application. If<br>
you're starting with a new product, you can build the use of Apple Guide into its design<br>
from the beginning; this can provide you with a competitive edge. If you're revising an<br>
existing product, you can add Apple Guide as a key feature. In either case, the<br>
instructional designer or technical writer should work closely with the software<br>
engineers to include an interactive task-oriented guide as an integral part of the<br>
design.&nbsp;&nbsp;&nbsp;Here's a suggested plan for doing that: 1.&nbsp;&nbsp;The instructional designer prepares<br>
a specification for how the application, Apple Guide, and the paper documentation will<br>
work together. The specification should include a description of the information that<br>
the guide database needs from the application and vice versa -- for example, how help<br>
is started, Apple events, context checks, and coach-mark locations.&nbsp;&nbsp;&nbsp;2.&nbsp;&nbsp;The software<br>
engineers use the instructional designer's specification to add the necessary Apple<br>
Guide features to the application.&nbsp;&nbsp;&nbsp;3.&nbsp;&nbsp;The instructional designer authors the database. <br>
4.&nbsp;&nbsp;The use of the guide database is included in the application's test suite. 
</p>
<h2>PUTTING IT ALL TOGETHER</h2>
<p>
It's up to you and your database author to assemble Apple Guide's features into useful<br>
and coherent help for your user. This section gives some suggestions for making Apple<br>
Guide as helpful as it can be. 
</p>
<p>
<b>MULTIPLE DATABASE FILES</b><br>
You should provide different guide database files for different needs. Apple Guide<br>
database possibilities include the following:
</p>
<ul>
<li>an Apple Guide "agent" that guides the user through a task</li>
<li>a tutorial to provide basic instruction</li>
<li>command reference</li>
<li>application shortcuts</li>
<li>databases that match the user's level of experience</li>
<li>a "here's what's new in this release" database instead of a read-me file<br>
(Marketing will love it!)</li>
</ul>
<p>
<b>&nbsp;HELP EVERYWHERE YOU NEED IT</b><br>
&nbsp;Your user should have access to help under all conditions. Here are some possibilities:
</p>
<ul>
<li>from the Help menu</li>
<li>from a help button in your tool palette</li>
<li>from a help button in your modeless alerts and dialogs from a help hot<br>
key, enabling the user to click an object and bring up a relevant help topic</li>
</ul>
<p>
<b>&nbsp;CONTEXT SENSITIVITY</b><br>
&nbsp;You, too, can use the buzzword "context sensitive." Use the Apple Guide features to<br>
provide "smart" help -- help that's tailored to the user's current context:
</p>
<ul>
<li>Start up Apple Guide in the look-for view with a list of context-sensitive<br>
topics. </li>
<li>Bypass the access window and go directly to the presentation window when<br>
the user initiates help from a control. </li>
<li>Respond to the guide database author's context checks. </li>
<li>Selectively mix in database content.</li>
</ul>
<p>
<b>&nbsp;INTERACTIVITY</b><br>
&nbsp;The built-in features of Apple Guide provide a high degree of interactivity. You can<br>
provide even more with integration:
</p>
<ul>
<li>Identify dynamic interface objects with coach marks. </li>
<li>Have Apple Guide notify you when the user is at a particular help panel<br>
(the help focus) so that your application can respond appropriately. </li>
<li>Have your help database author add user controls that send Apple events to<br>
your application. Use them to allow the user to interact with you.</li>
</ul>
<h2>&nbsp;NEXT STOP, GOLDEN MASTER</h2>
<p>
&nbsp;This article has covered the basics of how your application can integrate Apple Guide.<br>
There's more in the complete API, but you have enough here to get started. With or<br>
without integration, the help system is there to serve your user. It shouldn't be<br>
compensation for bad interface design, nor should you add it just to save money on<br>
manuals or user support. Help is there to make your user moreproductive with your<br>
product, leading to a positive user experience, lots of recommendations, and sales,<br>
sales, sales. 
</p>
<p>
It<i> can</i> be done. 
</p>
<h2>WHAT SYSTEMWIDE HELP MEANS</h2>
<p>
Because it's implemented as a system extension, Apple Guide is available to all<br>
applications systemwide. It's designed to help users within and across application<br>
boundaries. Apple Guide can guide a user through multiple applications including, but<br>
not limited to, the application that invoked it.
</p>
<p>
Apple Guide's systemwide nature has ramifications for everything you do with it.<br>
While it enables delivering an unprecedented level of help to users, it also presents<br>
certain programming challenges. Consider the following characteristics of systemwide<br>
help and what they mean to you as a developer.
</p>
<p>
<b>Help works across multiple applications. </b>Your application's guide database can<br>
guide a user through multiple applications, not just your own. You can provide help<br>
for tasks that involve system-level operations and the use of other applications.
</p>
<p>
One ramification of this is that if the user switches from your application to another<br>
one after starting up Apple Guide and without quitting your application or Apple Guide,<br>
Apple Guide will still be present and showing your guide database. This may be<br>
desirable, depending on what help you're providing. If not, the user can quit Apple<br>
Guide from the help window. Don't force Apple Guide to quit when your application goes<br>
to the background.
</p>
<p>
<b>Help is always available to the user. </b>Your application can always invoke Apple<br>
Guide, even if it's&nbsp;&nbsp;in use by another application. That application's guide database will<br>
be closed and yours will be opened and shown instead.
</p>
<p>
This works the other way around as well -- if the user invokes Apple Guide from the<br>
Help menu within another application while yours is open in the background, your<br>
guide database will be closed and the other application's will be opened and shown<br>
instead. Moreover, the other application can still make Apple Guide quit even if you<br>
closed its guide database to show your own.
</p>
<p>
The bottom line for you is that you can't assume that your guide database is always<br>
open, even if the user invoked it from within your application. A call for dealing with<br>
this is described later, under "Is Your Guide Database Open?"
</p>
<p>
<b>The user is always in control. </b> Users can quit Apple Guide at any time, even if<br>
they've switched from the application that started it up. Once again, this means that<br>
you can't assume your guide database is always open, even if the user invoked it from<br>
within your application.
</p>
<h2>ABOUT APPLE GUIDE DATABASE FILES</h2>
<p>
Apple Guide database files provide the content of the help that your application gives<br>
users. These files can be of the following two types:
</p>
<ul>
<li>kAGFileMain: Main or normal type of Apple Guide database file</li>
<li>kAGFileMixin: Mix-in database file, which modifies a main database file<br>
with updates and additions atrun time</li>
</ul>
<p>
Files of both types have a creator of kAGCreator, which&nbsp;&nbsp;is 'reno', and are further<br>
subdivided by database type according to the type of help information they contain. The<br>
database type is stored as part of the database content and determines where the file is<br>
represented in the Help menu, as indicated in Figure 2.
</p>
<p>
Apple Guide supports multiple guide database files but only one of each type, except for<br>
kAGFileDBTypeOther. You can have multiple kAGFileDBTypeOther files; they're added<br>
at the end of the Help menu, ordered by filename.
</p>
<p>
All Apple Guide database files located in the same&nbsp;&nbsp;folder as your application will be<br>
represented in the Help menu. (Note that aliases will work as well as database files<br>
themselves, but that folders nested within your application's folder will not be<br>
searched.)
</p>
<p>
If you don't want a guide database represented in the Help menu, you should separate<br>
the guide database from the application. In this case, you must provide a mechanism in<br>
your application to start up Apple Guide with that database, since the user can't do it<br>
from the Help menu. The section "Starting Up Apple Guide" tells all about this.
</p>
<p>
Databases can also have your creator and type, allowing you to use your own document<br>
icons. Databases identified this way won't show up on the Help menu and must be<br>
opened from your application.
</p>
<p>
<img src="img/171.gif" width="327 px"></img>
</p>
<p>
<b>&nbsp;Figure 2. </b>Menu items identified by database type
</p>
<p>
<b>JOHN POWERS </b>(AppleLink JOHNPOWERS), MWM, Apple employee, seeks intense<br>
relationship with software. Enjoys object-oriented design, craftsmanship, classical<br>
music, long walks, quiet moments, laser discs with popcorn, travel, engaging novels,<br>
and kinky polymorphism. Software must be willing to share time with extended<br>
family. Documentation a must. *
</p>
<p>
<b>The Apple Guide Developer's Kit</b> will soon be available from APDA (if it isn't<br>
already). It contains everything you need to author databases and integrate Apple Guide.<br>
Included in this kit is an authoring tool that compiles help content written with a<br>
standard word processor into an Apple Guide database file. The kit also contains sample<br>
help content files and documentation. *
</p>
<p>
<b>Thanks </b>to our technical reviewers Peter Commons, Winston Hendrickson, Josh<br>
Jacobs, Dave Lucky, Dave Lyons, and Eric Soldan.
</p>
</body>
</html>
