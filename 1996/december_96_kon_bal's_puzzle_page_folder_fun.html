<!DOCTYPE html>
<html>
<head>
<!-- Article ID: 62 - Extracted from develop-1996 -->
<!-- on 2025-01-18 by Giorgio Ferrara - giorgio<dot>ferrara<at>gmail<dot>com -->
<!-- The content is protected by the copyright of its respective owners -->
<title>December 96 - KON & BAL'S PUZZLE PAGE: Folder Fun</title>
<link href="../common/styles/main.css" rel="stylesheet" type="text/css">
</head>
<body>
<h1>KON &amp; BAL'S PUZZLE PAGE: Folder Fun</h1>
<h2>Konstantin Othmer and Bruce Leak</h2>
<p>
<img src="img/302.gif" width="150 px"></img>
</p>
<p>
<i style="font-size:125%;">See if you can solve this programming puzzle, presented in the</i>
<br>

<i style="font-size:125%;">form of a dialog between Konstantin Othmer (KON) and Bruce Leak</i>
<br>

<i style="font-size:125%;">(BAL). The dialog gives clues to help you. Keep guessing until you're</i>
<br>

<i style="font-size:125%;">done; your score is the number to the left of the clue that gave you</i>
<br>

<i style="font-size:125%;">the correct answer. Even if you never run into the particular</i>
<br>

<i style="font-size:125%;">problems being solved here, you'll learn some valuable debugging</i>
<br>

<i style="font-size:125%;">techniques that will help you solve your own programming</i>
<br>

<i style="font-size:125%;">conundrums. And you'll also learn interesting Macintosh trivia.</i>
</p>
<p><b>KON</b> It's you again.</p>
<p><b>BAL</b> It seems our bid for drumming up Puzzle Page authors<br>
hasn't gone well.</p>
<p><b>KON</b> I guess everyone's waiting for the Mac OS 8 release.<br>
From what I hear, they'll be waiting quite a while.</p>
<p><b>BAL</b> I've got a lot of work to do. Can we get on with this?</p>
<p><b>KON</b> OK. Have you ever heard of Retrospect Remote?</p>
<p><b>BAL</b> Yeah, we run it. It's that backup program. It slows<br>
your machine to a crawl when it's doing its thing, but we've<br>
never had a problem with it. Our engineers don't allow it on<br>
their machines, though.</p>
<p><b>KON</b> Apparently someone went around one morning and installed it<br>
while we were all sleeping. It's been running great for the<br>
last year, but suddenly one of the machines started showing<br>
an execution error.</p>
<p><b>BAL</b> Easy enough. Go check out the logs and see what it's<br>
complaining about.</p>
<p><b>100 KON</b> It says folders are nested too deep on that machine. Sure<br>
enough, the machine has a folder called "&lt;unknown name&gt;,"<br>
and inside that folder is another called "&lt;unknown name&gt;,"<br>
and so on. It was mixed in with our project files.</p>
<p><b>BAL</b> What system are you running?</p>
<p><b>KON</b> A Power Mac 7100/66 with 32 MB of RAM and an 800 MB<br>
hard disk, running system version 7.1.2 -- the "last trusted<br>
system," according to Chris Derossi.</p>
<p><b>BAL</b> What happens when you use the Finder to get info on the<br>
folder?</p>
<p><b>90 KON</b> It says there are 99 items inside this one for zero K of disk<br>
space.</p>
<p><b>BAL</b> Go in a level and try the same thing. Still 99 items?</p>
<p><b>KON</b> Yep.</p>
<p><b>BAL</b> Go in a few more levels and rename one of the folders. Come<br>
back out and go back in. Anything unusual?<br>
<p><b>KON</b> Nope. The renamed folder kept its new name. The Finder tells<br>
you there are 99 items inside it.</p>
<p><b>BAL</b> Just keep opening folders. How deep does it go?</p>
<p><b>80 KON</b> After opening folders for a few minutes, you get too bored to<br>
continue.</p>
<p><b>BAL</b> Rename every tenth folder or so, to create some landmarks.<br>
Dig down doing this. Can you Command-click on the window<br>
title and see the whole hierarchy?</p>
<p><b>KON</b> Yes. You're doing one heck of a test on the pop-up menu<br>
manager.</p>
<p><b>BAL</b> So, what happens?</p>
<p><b>70 KON</b> After you do this about 150 times, the Finder displays the<br>
familiar "out of memory" message. It says you might try<br>
closing some windows to make more memory available. I have<br>
the feeling this might be one case where that advice actually<br>
works!</p>
<p><b>BAL</b> Do a Get Info on the hard drive. How many items does it have?</p>
<p><b>KON</b> 16,774 items on disk.<br>
<p><b>BAL</b> Somehow I was expecting a larger number! Try copying the<br>
folder.</p>
<p><b>KON</b> We crash.</p>
<p><b>BAL</b> Where? Any clues?</p>
<p><b>KON</b> In CopyDoubler.</p>
<p><b>BAL</b> That sounds like a subject for another column. Hold down the<br>
Control key when copying the folder to tell CopyDoubler to<br>
stay out of it.</p>
<p><b>60 KON</b> The Finder puts up the copy dialog, waits about two minutes,<br>
advances the thermometer the entire way in about three<br>
seconds, and then waits another two minutes before finishing.<br>
The copy dialog says there are 100 items to be copied. You<br>
now have two folder hierarchies.</p>
<p><b>BAL</b> That's interesting. I've seen the Finder copy way more than<br>
100 items at one time, but somehow its knowledge of folder<br>
nesting is limited to 99 or 100. Do a Get Info on the drive<br>
again and see how many new items were created.</p>
<p><b>KON</b> Now there are 18,679 items on disk -- 1,905 new ones.</p>
<p><b>BAL</b> Copy it to a file server.</p>
<p><b>55 KON</b> OK. Now the Finder does the copy the same as before, except<br>
after the thermometer is finished, the dialog stays up,<br>
waiting for a long time.</p>
<p><b>BAL</b> How long?</p>
<p><b>KON</b> Suppose we go to a long dinner at the Peppermill Lounge.<br>
When we come back it still won't be done.</p>
<p><b>BAL</b> Look at the folder hierarchy on the network from another<br>
Mac.</p>
<p><b>KON</b> While it's still copying?</p>
<p><b>BAL</b> Sure.</p>
<p><b>50 KON</b> You see a bunch of folders, as you'd expect, except the<br>
network is really slow. Apparently the Finder is generating a<br>
lot of network traffic trying to create all those directories.</p>
<p><b>BAL</b> Stop that file copy.</p>
<p><b>45 KON</b> The Stop button in the copy dialog is highlighted (indicating<br>
that you pressed it), and the network is back to normal, but<br>
the copy dialog doesn't go away.</p>
<p><b>BAL</b> Reboot and look at the folders in Standard File.</p>
<p><b>KON</b> No new clues. How deep do you want do go?</p>
<p><b>BAL</b> Hmm. Try running Norton Utilities on the disk.</p>
<p><b>KON</b> There were a few bundle bits that are wrong. But once those<br>
are fixed, Norton says the disk is fine.</p>
<p><b>BAL</b> Try DropStuffing the folder.</p>
<p><b>KON</b> DropStuff crashes.</p>
<p><b>BAL</b> Try Disk First Aid.</p>
<p><b>40 KON</b> It tells you that the folder nesting exceeds the<br>
Finder-recommended nesting of 100. But other than that, it<br>
says the disk is fine.</p>
<p><b>BAL</b> I guess those folders are really there. The system is running<br>
into a bunch of boundary conditions trying to deal with them.<br>
The question is how they got there, and I'm not sure how we<br>
figure that out given that all we have is a smoking gun.</p>
<p><b>KON</b> Wait a second...the column isn't supposed to end this way!</p>
<p><b>BAL</b> OK. I've got an idea. I'll try looking at these folders from<br>
MPW with a<b>files -r -c</b> command.<br>
&gt;<p><b>35 KON</b> MPW prints out a bunch of folders and then crashes. The<br>
interesting thing is that it crashed right after printing out<br>
the 100th level down, which we know from the "rename<br>
every tenth folder" exercise we did earlier.</p>
<p><b>BAL</b> Well, there are some mysteries that we should be able to<br>
solve. Clearly, some software on this machine created the<br>
folder called "&lt;unknown name&gt;," probably when a directory<br>
with a null name or some other exception condition was<br>
encountered.</p>
<p><b>KON</b> OK.</p>
<p><b>BAL</b> It's probably the Finder, the File Manager, or one of the<br>
applications that's commonly used on the machine. Let's ask<br>
Paul Mercer if he knows anything about it.</p>
<p><b>30 Paul</b> First of all, the Finder isn't going to rename a folder on you.<br>
And second, even if it did, no one on the Finder team would<br>
give the folder a name that contains an angle bracket -- that's<br>
just too unpleasant aesthetically. Maybe the File Manager<br>
would do such a thing, though.</p>
<p><b>KON</b> We could try Dave Feldman. I'm not sure he'd have the same<br>
issues with angle brackets that Paul has.</p>
<p><b>25 Dave</b> No issue with angle brackets here! But the File Manager<br>
doesn't ever attempt to detect or fix damaged catalog info. It<br>
will rebuild the volume bitmap (that long pause when<br>
remounting a disk after a system crash), but it leaves<br>
everything else alone. No matter how much it's abused by the<br>
Finder, the File Manager will never surreptitiously set a<br>
folder to "&lt;unknown name&gt;." Tell Paul I said what does he<br>
know, he's been gone from Apple long enough to have forgotten<br>
what little he once knew about the File Manager.<br>
Furthermore, the File Manager doesn't care how deep you<br>
nest folders; that's a Finder problem.</p>
<p><b>BAL</b> Well, the system hasn't changed much since either of those<br>
guys left Apple, so it's probably something else. Maybe you<br>
can get someone at Apple to search all the system sources and<br>
see if they can come up with a hit on "unknown name."</p>
<p><b>20 KON</b> I talked to Jim Luther about it and he said it shows up in only<br>
one place -- the Alias Manager. Apparently the Alias Manager<br>
will store the name of the user who created the alias as part<br>
of the alias record. If a user who logs on as a guest creates an<br>
alias, the name of the alias creator is set to "unknown name,"<br>
but there are no angle brackets.</p>
<p><b>BAL</b> Let's grep the hard disk and see if we can find any hits on<br>
"&lt;unknown name&gt;."</p>
<p><b>KON</b> How do you propose we do that?</p>
<p><b>BAL</b> Have you seen AltaVista?</p>
<p><b>KON</b> You mean the search engine on the Internet? Totally awesome.<br>
When you do a query they can instantly give you a list of the<br>
top hits from any Web site. But what does that have to do with<br>
this puzzle?</p>
<p><b>BAL</b> Well, I figure they can search huge amounts of data way<br>
faster than we could ever do it on our local machine. So we<br>
dump the entire contents of the hard disk to a Web page,<br>
register it with AltaVista, and perform the search.</p>
<p><b>KON</b> A little unrealistic, but not a bad idea.</p>
<p><b>BAL</b> Ron Avitzur thought it up.</p>
<p><b>KON</b> For those keeping score, you're approaching 15.</p>
<p><b>BAL</b> OK, OK. I'll use Norton Disk Editor and search the whole<br>
volume for the string "&lt;unknown name&gt;."</p>
<p><b>15 KON</b> The first hit is in the catalog. I get the feeling you're going to<br>
find at least 1905 of these on this disk, probably more since<br>
you duplicated the folders so many times.</p>
<p><b>BAL</b> OK. Try it on one of your other development machines.</p>
<p><b>10 KON</b> The string is found in a bunch of places but the sectors aren't<br>
owned by a file. But then the needle in the haystack pokes<br>
your probing finger -- you find the string in the MPW Shell<br>
application.</p>
<p><b>BAL</b> Open up MPW Shell with ResEdit and find out which resource<br>
it's in.</p>
<p><b>KON</b> Duh! Wrong tool for the job! ResEdit can't search the entire<br>
resource fork.</p>
<p><b>BAL</b> OK. Use Resorcerer.</p>
<p><b>KON</b> You find the string in CODE resource 27, called %A5Init.</p>
<p><b>BAL</b> So, it sounds like we should contact someone in MPW land and<br>
see if they know what's going on. Here's Alex McKale; maybe<br>
he can help us.</p>
<p><b>5 Alex</b> Sure enough, Projector will create folders with the name<br>
"&lt;unknown name&gt;." CheckOutDir creates a folder hierarchy<br>
that matches the project hierarchy.</p>
<p><b>BAL</b> The project hierarchy on this machine is only three or four<br>
levels deep, not 1905! Any explanation for that?</p>
<p><b>Alex</b> Did the machine ever crash while checking out? Maybe some<br>
script got in an infinite loop, and you hit the reset button or<br>
crashed after some time. This would mean the depth of the<br>
hierarchy is based on how long the machine was running in<br>
the loop, rather than on some magic number, such as<br>
everyone's favorite year plus 1.</p>
<p><b>KON</b> It happened on Richard's machine. He says his Mac crashes all<br>
the time, and he'd be hard pressed to tell you what it was<br>
doing during any particular crash.</p>
<p><b>BAL</b> Hmm. I guess we just need a plausible explanation. Any ideas,<br>
Alex?</p>
<p><b>Alex</b> Your guess is as good as mine. CheckOutDir does very little<br>
error checking, so if the project tree got munged -- for<br>
example, if there was no terminator in the project folder<br>
hierarchy -- it would keep creating folders called "&lt;unknown<br>
name&gt;" until it hit a terminator. Give me a reproducible case,<br>
and this thing is dead meat.</p>
<p><b>KON</b> No can do. I guess the exact cause will remain a mystery,<br>
along with the true nature of consciousness, the details of<br>
Jimmy Hoffa's demise, and the location of my other red sock.<br>
Well, at least we managed to narrow it down to Projector, so<br>
we can point both our accusatory fingers in the same<br>
direction. If nothing else, maybe this will get the Projector<br>
folks to add a little more error checking to CheckOutDir.</p>
<p><b>BAL</b> Nasty.</p>
<p><b>KON</b> Yeah.</p>
<p class="spacer">&nbsp;</p>
<p class="spacer">&nbsp;</p>



<p>
<b>SCORING</b>
</p>
<p><table border="0"><tr><td><b>70-100</td><td></b>Congratulations! You win free lifetime upgrades to MPW.</td></tr>
<tr><td><b>45-60</td><td></b>You win a free copy of Mac OS 8.</td></tr>
<tr><td><b>25-40</td><td></b>You win a lifetime subscription to eWorld.</td></tr>
<tr><td><b>5-20</td><td></b>You win a dinner with Paul and Dave.</td></tr></table></p>
<p class="spacer">&nbsp;</p>
<p class="spacer">&nbsp;</p>



<p>
<b>KONSTANTIN OTHMER</b> AND <b>BRUCE LEAK</b> are cashing in on the enormous<br>
popularity of the Puzzle Page by starting their own online magazine. After rejecting<br>
titles like <i>MacsBug Life</i> and <i>Dead Mackerel</i>, they've settled on <i>Mired</i> as the name for<br>
their daily diary of debugging. The first issue will include hard-hitting articles like<br>
"MacsBug: The Best Command-Line Interface for the Mac?" and "Celebrity dcmds."<br>
Watch for it soon in your local cybernews shop!*
</p>
<p>
<b>Thanks to</b> Chris Derossi, Dave Feldman, Jim Luther, Alex McKale, and Paul Mercer<br>
for reviewing this column.*
</p>
</body>
</html>
