<!DOCTYPE html>
<html>
<head>
<!-- Article ID: 33 - Extracted from develop-1990 -->
<!-- on 2023-12-27 by Giorgio Ferrara - giorgio<dot>ferrara<at>gmail<dot>com -->
<!-- The content is protected by the copyright of its respective owners -->
<title>July 90 - THE INS AND OUTS OF ISO 9660 AND HIGH SIERRA</title>
<link href="../common/styles/main.css" rel="stylesheet" type="text/css">
</head>
<body>
<h2>THE INS AND OUTS OF ISO 9660 AND HIGH SIERRA</h2>
<img src="img/172.gif" width="197 px"></img><br>
<h1>BRIAN BECHTEL WITH HIS DAUGHTER MEG</h1>
<p>
<i>Any CD-ROM can be read at the bit level by any CD-ROM player, thanks to the</i><br>
<i>existence of standards for the physical format of such discs. Having this physical</i><br>
<i>format in common is nice, but it's not enough. We also need to be able to find specific</i><br>
<i>files on a CD, no matter which operating system we are using; we need a standard file</i><br>
<i>system format. High Sierra and its international equivalent ISO 9660 are standards</i><br>
<i>that define a file system usable under a variety of operating systems. This article</i><br>
<i>explores these standards and their implementation on the Macintosh, and discusses a</i><br>
<i>simple program you'll find on the accompanying Developer Essentials disc to convert</i><br>
<i>Macintosh files&nbsp;&nbsp;to ISO 9660 format.</i>
</p>
<p>
A file system organizes data logically on a CD. Different operating systems use<br>
different file systems to organize data, and thus a CD formatted with a native file<br>
system can only be read by one particular operating system. To overcome this obvious<br>
limit to the usefulness of CD-ROM as a storage and distribution medium, the industry<br>
has established standards for a file system that can be used under a variety of<br>
operating systems. The ISO 9660 standard and its predecessor High Sierra define a file<br>
system carefully attuned to CD-ROM characteristics.
</p>
<p>
In particular, because CDs have a relatively slow seek time and a high capacity, these<br>
standards make trade-offs that reduce the number of seeks needed to read a file, at the<br>
expense of space efficiency. And because CDs are read-only, concerns like space<br>
allocation, file deletion, and the like are not addressed in the standards. The standards<br>
apply only to the data track of a CD-ROM, not to audio tracks; and they do not apply to<br>
any media other than CD-ROM, such as erasable-optical drives. The standards do not<br>
favor any particular computer architecture. All significant multibyte numbers are<br>
recorded twice, once with the most significant byte first (msb order, used by Intel<br>
processors such as those in MS-DOS compatible computers) and once with the least<br>
significant byte first (lsb order, used by Motorola microprocessors such as those in<br>
the Macintosh). This enables easy implementation under a variety of operating<br>
systems, such as the Macintosh operating system, Apple II ProDOS 16 or GS/OS,<br>
MS-DOS, VMS, and the UNIX operating system. Let's look now at how the two standards<br>
developed.
</p>
<h2>ISO 9660 AND HIGH SIERRA: SOME HISTORY</h2>
<p>
A group of industry representatives met at Del Webb's High Sierra Hotel and Casino at<br>
Lake Tahoe, Nevada, in late 1985 to see if companies could cooperate in developing a<br>
common file system format for CD-ROM. The result of this series of meetings was the<br>
High Sierra format. This format is fully specified by the May 28, 1986 <i> Working</i><br>
<i>Paper for Information Processing--Volume and File Structure of Compact Read-Only</i><br>
<i>Optical Discs for Information Interchange</i>. For obvious reasons, this is known as the<br>
High Sierra paper.
</p>
<p>
The world at large then wanted to adopt an equivalent standard. The International<br>
Organization for Standardization pushed High Sierra through its standardization<br>
process, resulting in the international standard known as ISO 9660. (The organization<br>
is called the International Organization for Standardization, but the standard is <i> ISO</i><br>
<i>9660</i> .) This standard is described in the paper<i> ISO 9660--Volume and File Structure</i><br>
<i>of CD-ROM for Information Interchange</i>&nbsp;&nbsp;, known in the CD-ROM trade as the ISO<br>
standard.
</p>
<p>
Apple's Macintosh operating system and GS/OS, plus Microsoft's operating system<br>
MS-DOS, support both the ISO 9660 standard and the older High Sierra format.
</p>
<p>
ISO 9660 is the wave of the future--many existing CD-ROMs use the High Sierra<br>
format, but everyone is changing over to the ISO 9660 standard, and most if not all<br>
future discs will be in ISO 9660 format rather than High Sierra format. In the<br>
meantime, because "ISO 9660" doesn't roll off the tongue quite as nicely as "High<br>
Sierra," many people in the industry say "High Sierra" when they really mean "ISO<br>
9660" or "whatever that damn format is that my CD-ROM is supposed to be in." In<br>
this article, I do not use the terms interchangeably, but explicitly state which format<br>
I'm referring to. But for practical purposes, what I say about one format also applies<br>
to the other, with the exceptions I note.
</p>
<h2>HOW THE FORMATS ARE IMPLEMENTED ON THE MACINTOSH</h2>
<p>
The Macintosh supports both ISO 9660 and High Sierra through the use of a feature in<br>
the Macintosh file system called the external file system hook. This is a low-memory<br>
global that contains a pointer to an external file system handler to which multiple<br>
handlers are daisy-chained. To support ISO 9660 and High Sierra, Apple has written a<br>
new set of routines, contained in a file called Foreign File Access. This file, combined<br>
with the files High Sierra File Access and ISO 9660 File Access, provides complete<br>
support for the standard formats.
</p>
<p>
Because the ISO 9660 and High Sierra formats are supported via Foreign File Access<br>
instead of software that's part of a device driver, you can use any media to create a<br>
standard-format volume. In actual use, ISO 9660 and High Sierra only make sense on a<br>
CD-ROM; but you can create a test volume using any floppy or hard disk. 
</p>
<p>
<b>A LOOK AT THE FORMATS</b>The ISO 9660 standard and the older High Sierra format<br>
define each CD-ROM as a volume. Volumes can contain standard file structures, coded<br>
character set file structures for character encoding other than ASCII, or boot records.<br>
Boot records can contain either data or program code that may be needed by systems or<br>
applications.&nbsp;&nbsp;&nbsp;ISO 9660 and High Sierra specify
</p>
<ul>
<li> how to describe an arbitrary location on the volume--the logical format<br>
of the volume;</li>
<li> how to format and what to include in the descriptive information<br>
contained by each volume about itself--the volume descriptors;</li>
<li> how to format and what to include in the path table, which is an easy way<br>
to get to any directory on the volume;</li>
<li> how to format and what to include in the file directories and the directory<br>
records, which contain basic information about the files on the volume such as<br>
the filename, file size, file location, and so forth. </li>
</ul>
<p>
The discussion that follows is a reasonably technical description of the standards in<br>
each of these areas; it is <i>not</i>&nbsp;&nbsp;the definitive description. For the one true, proper<br>
definition of the standards, read the original specifications.
</p>
<p>
<b>THE LOGICAL FORMAT</b><br>
CD-ROMs are laid out in 2048-byte physical sectors. This physical layout is defined<br>
in a standard published by Philips and Sony known as the Yellow Book, and is <br>
independent of the type of volume formatting used. Under ISO 9660 and High Sierra,<br>
the CD is also laid out in 2048-byte logical sectors. Both formats also have the concept<br>
of a logical block, which is the smallest chunk of file data.&nbsp;&nbsp;&nbsp;A logical block can be 512,<br>
1024, or 2048 bytes. In general, file access information is laid out in sector-sized<br>
units, while actual file data is laid out in block-sized units. On most CDs, the block<br>
size is the same as the sector size at 2048 bytes, so this distinction isn't important.<br>
Figure 1 shows the layout of a volume in ISO 9660 or High Sierra format.
</p>
<p>
<img src="img/173.gif" width="542 px"></img>
</p>
<p>
<b>Figure 1</b> A Volume in ISO 9660 or High Sierra Format
</p>
<p>
<b>THE VOLUME DESCRIPTORS</b><br>
Information about the volume itself is contained in an array of 2048-byte entries,<br>
beginning at logical sector 16 on the disc, as shown in Figure 1. These are the volume<br>
descriptors. There are five types of volume descriptors: the primary volume<br>
descriptor, the secondary volume descriptor, the boot descriptor, the partition<br>
descriptor, and the volume descriptor terminator. Every volume descriptor is 2048<br>
bytes long (one sector). The first descriptor in the array is always a primary volume<br>
descriptor, and the last descriptor always a volume descriptor terminator. The other<br>
three volume descriptor types are optional. The boot descriptor and the partition<br>
descriptor aren't supported by the Macintosh, because the Macintosh boot code looks at<br>
the beginning of the disk for boot tracks, not at sector 16.
</p>
<p>
Each volume has one and only one <i> primary volume descriptor.</i>&nbsp;&nbsp;This descriptor<br>
consists of the volume name, some publishing information, and offsets to the path table<br>
and root directory. The primary volume descriptor also contains a copy of the root<br>
directory entry (to minimize the number of seeks necessary to find out information<br>
about a disc). In the directory structure pointed to by the primary volume descriptor,<br>
filenames can consist of the uppercase characters A through Z, the underscore, and the<br>
digits 0 through 9. This is a subset of ISO 646, an international character<br>
representation standard roughly equivalent to ASCII. You will see a sample primary<br>
volume descriptor later in this article in the section entitled "A Simple Formatting<br>
Program: ISO 9660 Floppy Builder."
</p>
<p>
A volume can have zero or more <i> secondary volume descriptors</i> . The purpose of the<br>
secondary volume descriptor is to enable you to press a CD-ROM that can display the<br>
directories in a nonroman character set, such as Japanese Kanji, Hebrew, or Arabic.<br>
In the directory structure pointed to by the secondary volume descriptor, the<br>
characters used to represent filenames are not restricted to ISO 646. This directory<br>
structure is separate from but parallel to the directory structure pointed to by the<br>
primary volume descriptor. The secondary volume descriptor contains the same<br>
information as the primary volume descriptor--although in a different alphabet--in<br>
all but two fields. The<code>volumeFlag </code>field is used to indicate whether a<br>
non-ISO-standard alphabet is being used. The<code>escapeSequences </code>field contains<br>
characters that define which alphabet is being used.
</p>
<p>
The files ISO 9660 File Access and High Sierra File Access each contain a resource<br>
used to determine if the Macintosh should use a secondary volume descriptor. The<br>
NRVD resource contains a word for the<code> volumeFlags </code>field, followed by 32 bytes for<br>
the<code> escapeSequences </code>field. If a secondary volume descriptor exists, and if the<br>
volume flags and escape sequences match those in the NRVD resource, then the<br>
secondary volume descriptor is used instead of the primary volume descriptor.
</p>
<p>
The <i>boot descriptor</i>&nbsp;&nbsp;was designed to allow the creator of a CD-ROM to include system<br>
information for booting from that CD-ROM. This descriptor is not supported on the<br>
Macintosh, since the Macintosh operating system looks for boot information at the<br>
beginning of the disk, in the area undefined by ISO 9660 and High Sierra. The <br>
<i>partition descriptor</i>&nbsp;&nbsp;is also unsupported on the Macintosh.
</p>
<p>
The <i>volume descriptor terminator</i>&nbsp;&nbsp;is a simple structure that serves to indicate the end<br>
of the volume descriptor array. Each volume contains one, and only one, volume<br>
descriptor terminator.
</p>
<p>
<b>THE PATH TABLE</b><br>
The <i>path table</i>&nbsp;&nbsp;describes the directory hierarchy in a compact form, containing<br>
entries for each of the volume's directories. Its purpose is to minimize the number of<br>
seeks necessary to get to a file's directory information. The Macintosh caches the path<br>
table in memory, enabling access to any directory with only a single seek.
</p>
<p>
ISO 9660 allows up to two identical copies of the path table to be stored on the disc,<br>
while High Sierra allows up to four copies. This is useful to operating systems that do<br>
not cache the path table in memory. In this case, copies of the path table can be stored<br>
at regular intervals on the disc--say a quarter of the way in and again three-quarters<br>
of the way in--to decrease the seek time necessary for the optical read head to find one<br>
of the copies.
</p>
<p>
The path table for a simple formatting program is shown later in this article.
</p>
<p>
<b>DIRECTORIES</b><br>
Directories are stored in a hierarchical tree. Each volume has a root directory, the<br>
parent to all other directories on the volume. Subdirectories can be nested up to eight<br>
levels deep (the root plus seven levels).
</p>
<p>
<i>Directory records</i>&nbsp;&nbsp;are the basic unit of information kept about each file. Each<br>
directory record contains the offset from the beginning of the disc to the file itself, the<br>
size of the file, date and time information for creation and modification, file attribute<br>
flags, information useful for interleaved files, and the filename (preceded by a length<br>
byte). There is also an optional extension field, used by the Macintosh and Apple II<br>
operating systems to store additional information not defined by the High Sierra and<br>
ISO 9660 formats but necessary to the operating system. A directory record for a<br>
simple formatting program is shown later in this article.
</p>
<p>
Additional file information necessary for multiuser operating systems such as the<br>
UNIX operating system or VMS is retained in a separate field known as the extended<br>
attribute record. Extended attribute records are recognized by the Macintosh, but they<br>
are ignored since they contain information that is irrelevant to it. 
</p>
<p>
A file identifier consists of a filename, a period, a file extension, a semicolon, and a<br>
file version number. File identifiers can use the uppercase English alphabet,<br>
numbers, and the underscore character (_), and can be up to 31 characters long.<br>
Either the filename or file extension can be missing, but not both; if the extension&nbsp;&nbsp;is<br>
missing, the period must still precede the semicolon; and the version number&nbsp;&nbsp;must<br>
exist. This means that valid file identifiers look like THIS_FILE.EXISTS;1&nbsp;&nbsp;or<br>
.ONLYEXTENSION;1 but that file identifiers like NO_PERIOD;1 or NO_VERSION are<br>
invalid. Both standards define a level-1 conformance, designed for compatibility with<br>
MS-DOS, that restricts filenames to eight characters, a period, three characters, a<br>
semicolon, and a version number.
</p>
<p>
There are two types of files: regular files and associated files. A regular file without an<br>
associated file is simply a stream of bytes, like the files used in an operating system<br>
such as the UNIX &#174; operating system or MS-DOS. An associated file is a file with the<br>
same name as a regular file, and with the associated file attribute bit set in the<br>
directory record. This scheme accommodates the data and resource forks of a Macintosh<br>
file, as we'll discuss later.
</p>
<p>
<b>HOW THE FORMATS DIFFER</b><br>
The differences between ISO 9660 and High Sierra are slight, and mostly of interest to<br>
programmers. They are as follows:
</p>
<ul>
<li> The primary and secondary volume descriptors differ in the type and<br>
number of fields they accommodate.</li>
<li> In ISO 9660, a bibliographic preparer field was added to the primary and<br>
secondary volume descriptors.</li>
<li> Up to four copies of the path table are allowed in High Sierra, but only<br>
two copies in ISO 9660.</li>
<li> Two fields changed position in the directory records in ISO 9660.</li>
<li> All date/time fields have an extra byte in ISO 9660, used to describe the<br>
15- minute offset from Universal Standard Time (GMT or UTC).</li>
<li> The order of directory records is slightly different in ISO 9660. In High<br>
Sierra, the associated file comes after the regular file with which it is<br>
associated; in ISO 9660, the associated file comes first.</li>
</ul>
<h2>HOW MACINTOSH FILES ARE STORED IN THE FORMATS</h2>
<p>
The Macintosh uses a file system called the Hierarchical File System (HFS). As its<br>
name implies, it is hierarchical in structure, like that specified by ISO 9660 and High<br>
Sierra; it supports subdirectories, called folders, where files can be logically grouped<br>
together. HFS corresponds reasonably well to the ISO 9660 and High Sierra formats,<br>
with some limitations. Let's look at specific parts of the information required by the<br>
Finder and see how the ISO 9660 and High Sierra support handles these issues.&nbsp;&nbsp;<b>FILE</b><br>
<b>FORKS</b>Every file in HFS has two forks: a resource fork and a data fork. The resource<br>
fork of an application file contains the resources used by the application (for example,<br>
the bit image for an icon or the title and commands for a menu) plus the application<br>
code. The data fork can contain anything an application wants to store there. Similarly,<br>
a document file contains the document's resources in its resource fork and the<br>
document's data in its data fork. In ISO 9660 and High Sierra format, the data fork of a<br>
Macintosh file is stored as a regular file, and the resource fork is stored as an<br>
associated file.
</p>
<p>
A Macintosh application's data fork may be empty. How this should be handled is not<br>
stated clearly in either the ISO 9660 or the High Sierra specification; however, in<br>
both cases, an associated file is defined to exist only in conjunction with a regular file<br>
of the same name. If the regular file (corresponding to the data fork) is missing, the<br>
Macintosh operating system handles the case correctly; however, MS-DOS won't show<br>
the file, because the MS-DOS CD-ROM extensions ignore files with the associated bit<br>
set. This is because all files in MS-DOS are regular files.
</p>
<p>
<b>FILE IDENTIFIERS</b><br>
Like ISO 9660 and High Sierra file identifiers, HFS filenames can have a maximum of<br>
31 characters. HFS filenames differ from valid ISO 9660 and High Sierra file<br>
identifiers in the following ways:
</p>
<ul>
<li> HFS does not distinguish between uppercase and lowercase letters; the<br>
names "forecast," "Forecast," and "FoReCaSt" all refer to the same file.</li>
<li> HFS allows any character to be used in a filename except the colon (:).<br>
This means that filenames such as "My payroll file" or "&amp;Aring;&#201;&amp;icirc;&#248;&#220;"<br>
are perfectly acceptable on the Macintosh.</li>
<li> In HFS there is no concept of a filename extension. File types are stored<br>
as part of the Finder information.</li>
</ul>
<p>
These differences mean that many HFS filenames are illegal in ISO 9660 or High<br>
Sierra format. This may cause problems in an application that depends on hard-coded<br>
filenames. For example, Hypercard requires that the home stack be named HOME, but<br>
this is illegal in ISO 9660 and High Sierra. The legal ISO 9660 or High Sierra name is<br>
HOME.;1, which won't be found by Hypercard. Some versions of Videoworks depend<br>
upon sounds being in a file named Sounds. The only solution is to have the user copy<br>
such files over to an HFS volume and rename them.
</p>
<p>
<b>FILE TYPE AND CREATOR</b><br>
To establish the proper interface with the Finder, when a Macintosh application<br>
creates a file it sets the file's creator and file type. Normally it sets the creator to its<br>
signature, which is a unique four- letter sequence by which the Finder can identify it,<br>
such as MACA for MacWrite, XCEL for Excel, and FNDR for Finder. It sets the file type<br>
to a four-character sequence that identifies files of that type, such as TEXT for plain<br>
text or documents of unknown type, APPL for applications, and WORD for MacWrite<br>
documents. When the user asks the Finder to open or print the file, the Finder starts<br>
up the application whose signature is the file's creator and passes the file type to the<br>
application, along with the filename and other identifying information.&nbsp;&nbsp;&nbsp;This<br>
information about each file is not defined in either High Sierra or the ISO 9660<br>
standard. To preserve this file-specific information, Apple has defined a legitimate<br>
extension to ISO 9660 (which also applies to High Sierra), documented in <i> CD-ROM</i><br>
<i>and the Macintosh Computer</i> , included on the<i>Developer Essentials</i>&nbsp;&nbsp;disc. The extension<br>
specifies how to use the optional<code> SystemUse </code>field present in each ISO 9660 directory<br>
record to accommodate the file type and file creator.
</p>
<p>
If a CD-ROM has been pressed in ISO 9660 or High Sierra format without the Apple<br>
extension, all files on the disc are considered to be of type TEXT and creator hscd. TEXT<br>
is a generic type that can be read successfully by many Macintosh applications; hscd is<br>
a creator registered with Developer Technical Support that does not correspond to any<br>
application or utility. If the CD-ROM has been pressed with the Apple extension, then<br>
files on the disc can have any arbitrary type and creator.
</p>
<p>
<b>FINDER FLAGS</b><br>
The Finder flags are defined in Technical Note #40, Finder Flags. Only the invisible<br>
bit has an analogy in the ISO 9660 and High Sierra formats, but with the Apple<br>
extension to ISO 9660, the<code>SystemUse </code>field in the directory record accommodates<br>
Finder flags. If the CD-ROM has been pressed with the Apple extension, only bits 5<br>
(always switch launch), 12 (system file), 13 (bundle bit), and 15 (locked) can be<br>
used. All other bits are either ignored or set due to internal workings of the file<br>
system translator. Flags indicating that a file is on the desktop or in the trash are not<br>
supported; all files are assumed to be in their folders.
</p>
<p>
<b>DESKTOP INFORMATION</b><br>
The Finder also requires some information describing how files on the desktop are to<br>
be viewed, the icon to display for a specific file, the position of folders and file icons<br>
on the desktop, and the default scroll position when the user opens a folder. This<br>
information is contained in the<code> FInfo</code>,<code> FXInfo</code>,<code>DInfo</code>, and<code> DXInfo</code> structures<br>
documented on pages IV-104 through IV-106 of <i> Inside Macintosh</i> . File or folder<br>
comments are kept in the Desktop file. None of this information can be specified when<br>
pressing a CD-ROM in ISO 9660 or High Sierra format. Some of it is computed by the<br>
ISO 9660 File Access or High Sierra File Access software, however.
</p>
<p>
Due to some deficiencies in the original design of the Finder, the correct icon cannot be<br>
displayed for a file on an ISO 9660 or a High Sierra disc. This is because the Finder<br>
does not actually ask for the icon of a file; rather, it assumes the existence of a <br>
<i>desktop database</i>&nbsp;&nbsp;that contains these mappings, and makes a special call, giving only<br>
the file creator and type. The software to provide this information was designed to be<br>
very HFS-specific. Currently, even if the icon bitmap for a file on an ISO 9660 or a<br>
High Sierra disc is defined in the Apple extension, it is not used by the Finder.
</p>
<p>
<img src="img/174.gif" width="129 px"></img>
</p>
<p>
<img src="img/175.gif" width="119 px"></img>
</p>
<p>
Consequently, all files on a High Sierra or an ISO 9660 disc display a generic icon.&nbsp;&nbsp;If<br>
such a file is copied to a hard disk, the correct icon is then displayed on the desktop. If<br>
the user double-clicks on a generic application icon, the application opens correctly.<br>
If the user double-clicks on a generic document icon, and the associated application<br>
exists only on CD-ROM and not in the current directory, the application will not be<br>
found; if the application exists on an HFS volume (because the user has copied it<br>
there), it will be found. 
</p>
<p>
Under HFS, the Finder keeps track of the position of a file icon on the desktop or in a<br>
folder by using a special field; under High Sierra and ISO 9660, an icon's position is<br>
computed when the folder is opened, and cannot be changed. File and folder comments<br>
are not supported under the ISO 9660 and High Sierra formats. The view is always<br>
assumed to be View by Icon and the scroll position is always assumed to be at the top of<br>
the folder; these items are hard-coded in the file system translators. 
</p>
<p>
<b>SUMMARY</b><br>
As a developer, you don't have to worry about files on an ISO 9660 or a High Sierra<br>
CD-ROM looking different to your application. You may have to worry about filenames,<br>
if you have hard- coded a particular filename into your application (which is always a<br>
bad idea anyway.) Except for the icons not showing up properly (a major exception),<br>
your users don't really see a difference between ISO 9660, High Sierra, and<br>
HFS-format CD-ROMs. Names are reported back to the Finder exactly as found on the<br>
High Sierra or ISO 9660 volume; they are not altered in any way, except that they are<br>
truncated at 3 1 characters if they started out longer.
</p>
<h2>STRANGE BEHAVIOR IN ISO 9660 AND HIGH SIERRA<br>
SUPPORT</h2>
<p>
Version 1 of ISO 9660 File Access and High Sierra File Access had a misfeature that<br>
slowed down volume mounting times on CD-ROMs with a large number of files. Because<br>
neither the ISO 9660 nor the High Sierra format contains a count of the total number<br>
of files on a volume, the access software was iterating over the volume to find this<br>
number to stuff into the volume control block. This could make a&nbsp;&nbsp;CD-ROM with<br>
10,000 files on it take up to 20 minutes to mount.
</p>
<p>
It turns out that the volume control block field that was being set is used in only one<br>
place in the Macintosh operating system: the file count of the<code> GetInfo </code>of the volume.<br>
Version 2 of High Sierra File Access and ISO 9660 File Access fixes this problem by<br>
setting the appropriate field in the volume control block to 0. A special hard-coded<br>
comment has been added to the volume's<code>GetInfo </code>box that says either "The number of<br>
files shown is incorrect due to limitations of the High Sierra format" or "The number<br>
of files shown is incorrect due to limitations of the ISO 9660 format."
</p>
<h2>SO HOW DO I PRESS AN ISO 9660 CD-ROM?</h2>
<p>
CD-ROMs are actually pressed from an image of a disk. To press a CD-ROM in ISO<br>
9660 or High Sierra format, you need some premastering software that creates a disk<br>
in the appropriate format. You can either hire a CD-ROM pressing plant to convert<br>
your files to the ISO 9660 format, or you can purchase a system to do it yourself, or<br>
you can write your own ISO 9660 formatting software.&nbsp;&nbsp;If you want to write your own<br>
software, you'll find a simple example program on&nbsp;&nbsp;the <i>Developer Essentials</i>&nbsp;&nbsp;disc to<br>
get you started. The program is called ISO 9660 Floppy Builder and is written in<br>
Think C. It builds disks conforming to the ISO 9660 standard.
</p>
<h2>A SIMPLE FORMATTING PROGRAM: ISO 9660 FLOPPY BUILDER</h2>
<p>
ISO 9660 Floppy Builder has a number of features, listed below. The bracketed<br>
number after each feature indicates the section in the formal ISO 9660 document<br>
referred to earlier that describes this feature. You should read that section of the ISO<br>
9660 document for more detail about each feature.
</p>
<ul>
<li> Assumes that the logical sector size is 2048. [6.1.2]</li>
<li> Assumes that the logical block size is 2048. [6.2.2]</li>
<li> Writes a primary volume descriptor. [8.4]</li>
<li> Writes a volume descriptor terminator. [8.3]</li>
<li> Supports the Apple extensions to ISO 9660.</li>
<li> Enables the user to specify a volume name. The volume name is<br>
automatically converted to the proper character subset. [8.4.6]</li>
<li> Enables the user to choose, via a standard file dialog, files to be added to<br>
the ISO 9660 disk. All files are currently put in the root directory.</li>
<li> Copies both the resource fork and the data fork of a file to the disk. The<br>
resource fork is stored as the associated file.</li>
</ul>
<p>
ISO 9660 Floppy Builder is a demonstration program; it doesn't do many of the<br>
difficult parts of building a disk in ISO 9660 format. Specifically, it doesn't support:<br>
subdirectories (folders), keeping the files in a directory in alphabetical order, a main<br>
directory whose total size exceeds one block of 2048 bytes, a block size other than<br>
2048 bytes, secondary volume descriptors (used to implement non-ASCII alphabets),<br>
or more than one logical sector of directory records.
</p>
<p>
<b>TO USE THE PROGRAM</b><br>
To use the program, start with a formatted blank floppy. We will unmount and format<br>
the disk as part of the process of making it into an ISO 9660 format disk. All data will<br>
be lost from the floppy inserted.
</p>
<p>
Select "Specify Files for Root..." to put files into the root directory. You'll be asked for<br>
the names of the files to be copied over via a standard file dialog. When you've finished<br>
selecting filenames, click the Cancel button.
</p>
<p>
<b>A CLOSER LOOK AT THE CODE</b><br>
Let's look at the C structures we'll use to implement ISO 9660. We need three basic<br>
data structures: the primary volume descriptor, the path table, and the directory<br>
record. A primary volume descriptor has the basic data for the entire volume. It looks<br>
like this in C:
</p>
<pre>typedef unsigned char Byte;
typedef unsigned short Word;
typedef unsigned long Long;

typedef struct
{
    Byte    VDType;                 /* Must be 1 for primary volume
                                       descriptor. */
    char    VSStdId[5];             /* Must be &#8220;CD001&#8221;. */
    Byte    VSStdVersion;           /* Must be 1. */
    Byte    volumeFlags;            /* 0 in primary volume
                                       descriptor. */
    char    systemIdentifier[32];   /* What system this CD-ROM is
                                       meant for. */
    char    volumeIdentifier[32];   /* The volume name. */
    char    Reserved2[8];           /* Must be 0's. */
    Long    lsbVolumeSpaceSize;     /* Volume size, least-significant
                                       -byte order. */
    Long    msbVolumeSpaceSize;     /* Volume size, most-significant
                                       -byte order. */
    char    escapeSequences[32];    /* 0's in primary volume
                                       descriptor */
    Word    lsbVolumeSetSize;       /* Number of volumes in volume
                                       set (must be 1). */
    Word    msbVolumeSetSize;
    Word    lsbVolumeSetSequenceNumber;/* Which volume in volume set
                                          (not used). */
    Word    msbVolumeSetSequenceNumber;
    Word    lsbLogicalBlockSize;    /* We'll assume 2048 for block
                                       size. */
    Word    msbLogicalBlockSize;
    Long    lsbPathTableSize;       /* How many bytes in path
                                       table. */
    Long    msbPathTableSize;
    Long    lsbPathTable1;          /* Mandatory occurrence. */
    Long    lsbPathTable2;          /* Optional occurrence. */
    Long    msbPathTable1;          /* Mandatory occurrence. */
    Long    msbPathTable2;          /* Optional occurrence. */
    char    rootDirectoryRecord[34];   /* Duplicate root
                                          directory entry. */
    char    volumeSetIdentifier[128];  /* Various copyright and
                                          control fields follow. */
    char    publisherIdentifier[128];
    char    dataPreparerIdentifier[128];
    char    applicationIdentifier[128];
    char    copyrightFileIdentifier[37];
    char    abstractFileIdentifier[37];
    char    bibliographicFileIdentifier[37];
    char    volumeCreation[17];
    char    volumeModification[17];
    char    volumeExpiration[17];
    char    volumeEffective[17];
    char    FileStructureStandardVersion;
    char    Reserved4;               /* Must be 0. */
    char    ApplicationUse[512];
    char    FutureStandardization[653];
} PVD, *PVDPtr;</pre>
<p>
The path table looks like this in C:
</p>
<pre>typedef char   dirIDArray[8];

typedef struct
{
    byte    len_di;         /* Length of directory identifier. */
    byte    XARlength;      /* Extended attribute record length. */
    Long    dirLocation;    /* First logical block where directory
                               is stored. */
    Word    parentDN;       /* Parent directory number. */
    dirIDArray  dirID;      /* Directory identifier: actual length
                               is */
                    /* len_di; there is an extra blank */
                    /* byte if len_di is odd. */
} PathTableRecord, *PathTableRecordPtr;</pre>
<p>
Notice that this strucure is difficult to describe in C, because C requires that arrays of<br>
characters have a fixed size, and the character arrays in these records are variable in<br>
size. The path table records are packed together, so you'll see some grungy code to<br>
move a pointer along in the variable records of the path table.
</p>
<p>
The directory record looks like this in C:
</p>
<pre>typedef struct
{
    char    signature[2];       /* $41 $41 - &#8216;AA' famous value. */
    byte    extensionLength;    /* $0E for this ID. */
    byte    systemUseID;        /* 02 = HFS. */
    byte    fileType[4];        /* Such as &#8216;TEXT' or &#8216;STAK'. */
    byte    fileCreator[4];     /* Such as &#8216;hscd' or &#8216;WILD'. */
    byte    finderFlags[2];
} AppleExtension;

typedef struct
{
    byte    len_dr;         /* Directory record length. */
    byte    XARlength;      /* Extended attribute record length. */
    Long    lsbStart;       /* First logical block where file
                               starts. */
    Long    msbStart;
    Long    lsbDataLength;  /* Number of bytes in file. */
    Long    msbDataLength;
    byte    year;           /* Since 1900. */
    byte    month;
    byte    day;
    byte    hour;
    byte    minute;
    byte    second;
    byte    gmtOffset;      /* 15-minute offset from Universal
                               Time. */
    byte    fileFlags;      /* Attributes of a file or directory. */
    byte    interleaveSize; /* Used for interleaved files. */
    byte    interleaveSkip; /* Used for interleaved files. */
    Word    lsbVolSetSeqNum;  /* Which volume in volume set contains
                                 this file. */
    Word    msbVolSetSeqNum;
    byte    len_fi;         /* Length of file identifier that
                               follows. */
    char    fi[37];         /* File identifier: actual is len_fi. */
                      /* Contains extra blank byte if len_fi odd. */
    AppleExtension apple;   /* This actually fits immediately after
                               the fi[] */
                            /* field, or after its padding byte. */
} DirRcd, *DirRcdPtr;</pre>
<p>
&nbsp;Again, this structure is difficult to describe in C. The directory records are packed<br>
into 2048-byte blocks. No directory record is allowed to span a block, so any extra<br>
bytes at the end of a directory record block are ignored. We'll ignore such details in<br>
this simple example.
</p>
<p>
&nbsp;Our basic flow of control is simple. The core of the program is in the file BuildISO.c.<br>
(See<code>CreateAVolume</code> for the main core code.) When we get a floppy, we check to see if<br>
it is formatted. If so, we ask the user if he or she wants to continue (to make sure we<br>
don't accidentally destroy a useful floppy). We create a primary volume descriptor<br>
(by calling<code>CreatePVD</code>) and fill in most of the fields with blanks. We create a simple<br>
path table. Because we don't have any subdirectories, we can build an extremely<br>
simple path table with only one entry (for the root). We make a copy of the path table<br>
in both least-significant-byte and most-significant-byte order. 
</p>
<p>
&nbsp;At this point, we loop, prompting the user for a filename. (See the routine<br>
<code>CreateFiles </code>for details.) When the user selects a file, we get the Finder information<br>
for that file (<code>GetFileInfo</code>) and check to see if the file has a resource fork. If the file<br>
has a resource fork, we create an associated file directory record, and copy the<br>
resource fork to the floppy. We always create a regular file, even if the file in<br>
question has no data fork. (This is an arguable point. The Macintosh ISO 9660 support<br>
works fine on files with only an associated file, but users of other operating systems<br>
get bothered by the fact that files consisting of only an associated file don't show up in<br>
their directory listings. Creating a regular file, even if the data fork is empty,<br>
ensures that the same number of files shows up on the Macintosh and&nbsp;&nbsp;MS-DOS or<br>
other operating systems.)
</p>
<p>
<b>POSSIBLE IMPROVEMENTS</b><br>
Improvements you can make to this sample program include the following:
</p>
<ul>
<li> Add secondary volume descriptor support.</li>
<li> Add subdirectories. There are a lot of subtle issues with ordering of<br>
records in the path table that I've managed to avoid by not permitting<br>
subdirectories.</li>
<li> Give the program a real user interface. Ideally, you'd show a Finder-like<br>
set of volumes and let the user drag files (and folders) from a HFS volume onto<br>
the ISO 9660 volume.</li>
<li> Allow hard disks to be specified. This requires changing the <code>drvName</code><br>
constant in iso9660.h.</li>
</ul>
<h2>IN CONCLUSION</h2>
<p>
If you've read to this point, you know more about ISO 9660 and High Sierra than you<br>
ever thought your attention span could tolerate. You know where the formats came<br>
from, how they're implemented on the Macintosh, what they specify, how Macintosh<br>
files are stored in these formats, how to press a CD-ROM in one of these formats, and<br>
even how to write a program to convert HFS files to one of these formats. The point of<br>
all this is that ISO 9660 (and its older cousin High Sierra) gives you an operating<br>
system independent platform for delivering information, thus opening up new markets<br>
for your applications. If you are trying to penetrate multiple markets without using<br>
ISO 9660, you are just pounding sand.
</p>
<p>
<b>COMPANIES TO CONTACT FOR CD-ROM PRODUCTION</b>
</p>
<p class="spacer">&nbsp;</p>
<p>
Here's a list of pressing plants that can convert your files to the ISO 9660 format:
</p>
<p>
3M Optical Recording<br>
Building 223-5S-01<br>
3M Center<br>
St. Paul, MN 55144<br>
612/736-3274<br>
Mark Arps/Dick Tendill<br>
AppleLink: D2462
</p>
<p>
DADC<br>
1800 N. Fruitridge Ave.<br>
Terre Haute, IN 47804<br>
812/462-8100<br>
Linda Watson/Kozo Arai<br>
AppleLink: D2125
</p>
<p>
Disctronics<br>
1120 Cosby Way<br>
Anaheim, CA 92806<br>
714/630-6700<br>
Wan Seegmiller
</p>
<p>
Philips Dupont Optical<br>
1409 Foulk Road<br>
Suite 200<br>
Wilmington, DE 19803<br>
800/433-3475<br>
Jill Jones<br>
AppleLink: D2173
</p>
<p>
Nimbus Information Systems<br>
SR 629, Guildford Farm<br>
Ruckersville, VA 22968<br>
800/782-0778<br>
Larry Boden
</p>
<p>
Denon America<br>
222 New Road<br>
Parsippany, NJ 07054<br>
201/575-2532<br>
Nob Tokutake/Ben Garcia
</p>
<p>
If you want to buy your own premastering system, you can contact one of the following:
</p>
<p>
Meridian Data, Inc.<br>
5615 Scotts Valley Drive<br>
Scotts Valley, CA 95066<br>
408/438-3100<br>
Dean Quarnstrom
</p>
<p>
Optical Media Int'l.<br>
485 Alberto Way<br>
Los Gatos, CA 95032<br>
408/395-4332<br>
Applelink: D1490
</p>
<p>
<b>BRIAN BECHTEL</b> works in the Advanced Technology Group, where he applies to his<br>
everyday life Wernher Von Braun's slogan, "Research is what I do when I don't know<br>
what I'm doing." His title of Witzelsuchter is derived from an obscure medical<br>
condition (usually caused by brain lesions) in which the patient takes an intense<br>
interest in telling long, pointless stories and jokes. People who know him say this title<br>
is appropriate. Brian claims the lesions resulted from nine months of studying the ISO<br>
9660 and High Sierra standards documents. He also wrote the <i> HyperCard CD Audio</i><br>
<i>Toolkit</i>&nbsp;&nbsp;. He graduated from Occidental College with an A.B. in math. Meg, his daughter,<br>
attends the Apple Child Care Center. His favorite food is chocolate, as is his favorite<br>
color. He says he plays lousy acoustic guitar and roots for the LA Dodgers. His identical<br>
twin, Bradley, manages technical support at some other Silicon Valley company.&nbsp;&nbsp;*
</p>
<p>
If you're really interested in the standards, you should get copies of the full<br>
specifications. You can get the May 28, 1986, High Sierra specification from
</p>
<p>
National Institute of Standards and Technology<br>
Administration 101<br>
Library E-106<br>
Gaithersburg, MD 20899
</p>
<p>
You can get the ISO 9660 specification from any of the following:
</p>
<p>
American National Standards Institute<br>
1430 Broadway<br>
New York, NY 10018Sales Department: 212/642-4900
</p>
<p class="spacer">&nbsp;</p>
<p>
ECMA Headquarters<br>
Rue du Rhone 114<br>
CH-1204<br>
Geneva, Switzerland
</p>
<p>
Global Engineering Documents<br>
800/854-7175 or 714/261-1455
</p>
<p>
For the five people out there who really care: Apple's High Sierra and ISO access<br>
software supports level-2 interchange, according to section 10.2 of the ISO 9660<br>
specification.&nbsp;&nbsp;This means it supports interleaved files, but not multivolume sets.*
</p>
<p>
<b>Thanks to Our Technical Reviewers:</b> Bill Galcher, Matt Gulick, Andy Poggio, <br>
Llew Roberts, Keith Rollin, Helen Wang
</p>
</body>
</html>
